---
  layout: post
  title: "Releasing Fjall 3.0 - Fjall 3.0 のリリース"
  date: 2026-01-02T18:03:01.523Z
  categories: [tech, world-news]
  tags: [tech-news, japan]
  source_url: "https://fjall-rs.github.io/post/fjall-3/"
  source_title: "Releasing Fjall 3.0 | fjall-rs"
  source_id: 877945588
  excerpt: "Rust製LSMエンジンFjall 3.0が性能向上と互換性を両立、組込みK/Vの有力候補に"
  image: "https://fjall-rs.github.io/media/thumbs/kirkjufell.jpg"
---

# Releasing Fjall 3.0 - Fjall 3.0 のリリース
RocksDBを意識したRust製ストレージの大刷新──Fjall 3.0が描く「長寿命・高性能・安全な組み込みK/Vストレージ」

## 要約
Fjall 3.0はRustで書かれたログ構造マージ（LSM）型の組み込みK/Vエンジンを全面的に書き換えたメジャーリリースで、ブロックフォーマット、メモリ利用、API、ガベージコレクション、ディスクフォーマットなどを再設計して大規模データでの性能と長期互換性を高めている。

## この記事を読むべき理由
日本のスタートアップ〜大企業のバックエンド、IoT、時系列データ基盤、オンプレ/エッジで「軽量かつ高速、かつ安全な埋込みストレージ」を求める場面が増えています。Rust生態系で最も本格的な選択肢の一つが大きく進化したため、代替DBの候補として検討すべき重要アップデートです。

## 詳細解説
- LSMツリーの基礎はそのままに、ディスク上の「テーブル（テーブルファイル）」とそのマネジメントを全面改良。書き込みは引き続き順次I/O中心で書き込み増幅を抑える設計。
- ブロックフォーマットの再設計：各ブロックを単一のバイト配列として一括割当てし、内部に稀疎（sparse）な再起点インデックスを埋め込む。これによりデシリアライズを回避して未キャッシュ読取りが大幅高速化（ベンチで2x〜100xの改善レンジ）。
- プレフィクストランケーション：長い複合キーで共通接頭辞を切り詰めて保存し、ブロックキャッシュ効率を改善。ただし再起点（restart）は完全キーを保持して局所性を保つ工夫あり。
- ブロック内ハッシュ索引：小さなバケットテーブルを埋め込み、衝突時は二分探索へフォールバック。hash_ratioでメモリ/速度のトレードオフ調整が可能。
- Seqno短縮：コンパクションで不要なスナップショットが無ければシーケンス番号をリセットして可変長エンコーディングの無駄を削減。
- Version（SuperVersion）モデル導入：LSMの時点状態をコピオンライトで管理し、ロック戦略を簡素化。スナップショット読取はコンパクションの影響を受けにくい。
- K/V分離とBlob GC：Blob（大きな値）は別ファイルに分離し、GCをコンパクションに組み込むことで停止時間とメンテを削減。
- SFA（Simple File Archive）：テーブル／ブロブ／バージョンファイル用の軽量アーカイブ層を導入し、ToCに128bitチェックサムを付与。

## 実践ポイント
- まずは自社ワークロードでベンチを：ブロックサイズ、restart_interval、hash_ratioが性能に大きく影響するため、現行データで比較検証すること。
- 長い複合キーや時系列センサーデータならプレフィクストランケーションとseqno短縮の恩恵が大きい。
- Blobが多いワークロードはK/V分離でコンパクション負荷が劇的に下がる可能性がある。GCパラメータを調整して自動化を有効化する。
- ディスクフォーマットが変わっているため、本番移行時はマイグレーション計画とバックアップを入念に行う。
- Fjall 3.0はRustでの組み込みDB候補として注目に値するため、PoCでの早期評価を推奨。
