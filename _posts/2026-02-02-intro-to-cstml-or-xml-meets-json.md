---
layout: post
title: "Intro to CSTML (or: XML meets JSON) - CSTML入門（XMLがJSONと出会う場所）"
date: 2026-02-02T18:05:40.122Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://docs.bablr.org/guides/cstml/"
source_title: "Intro to CSTML | Docs"
source_id: 1728670685
excerpt: "CSTMLでコードをそのまま構文木化し、VSCode拡張やスニペットへ即応用"
---

# Intro to CSTML (or: XML meets JSON) - CSTML入門（XMLがJSONと出会う場所）
CSTMLで「コードがそのままデータになる」 — 構文ツリーを人が読めるマークアップで扱う新提案

## 要約
CSTMLは「Concrete Syntax Tree Markup Language」。テキスト（コードや文章）をそのまま保持しつつ、JSON風の属性とXML/HTML風のタグで具体構文木（CST）を表現する新しいマークアップ形式です。

## この記事を読むべき理由
エディタ拡張、スニペット、構文解析ツール、リファクタリングなど、ソースをそのまま扱うツール開発に直結するため、日本の開発現場やIDEプラグイン作りに有益です。既存の言語パーサーを少し拡張するだけで大量の互換ドキュメントが得られる点が実務上の魅力。

## 詳細解説
- 主要アイデア
  - テキスト本体をダブルクォートで表現し、そこにタグを挿入して「テキストにメタ情報を付与」する点が特徴。これによりフォーマッタでテキストを整形しても意味を壊さない。
- ノード構造
  - 開閉タグはHTML準拠だが、閉じタグに名前を繰り返さない（例: <Verb> "jumped" </>）。自己閉じタグやJSON風の属性（任意のJSON構造を許容）を持てる。
- トークンとトークンフラグ
  - 生の文字列は暗黙にトークンノード（* フラグ）で包まれる。これにより文字列にも属性を付けられる余地が確保される。
- 参照（References）
  - ノード同士を名前付き参照で結べる（例: subject:, object:, modifier[]:）。配列参照は [] で表現。
- ギャップ（Gaps）とテンプレート
  - <//> で「欠損部分」を表現でき、$ を付けたノードはテンプレート（部分的な文書）を示す。スニペットや部分構文を安全に扱える。
- シフト（Shifting）とカバー（Cover）
  - 左から右に解析する際、既に確定したノードが後から上書き的に拡張される「シフト」を表現する仕組み（refに ++ フラグ）。解析候補を扱うためのカバー（_Name）やトリビア参照（#:)で空白やコメントを安全に配置できる。
- 名前空間（Namespaces）
  - :Name: のバインディングタグでシンプルに名前空間を導入。XMLのようなURL依存が無く、バインディングを差し替えるだけでノードの意味を保てる点が設計上の強み。
- パーサードリブンな普及戦略
  - CSTMLは「パーサーが吐く出力」そのものに最適化されており、既存パーサー（例：BABLR）でCSTML出力を作れば短期間で大量の実利用ドキュメントが生成可能。

## 実践ポイント
- エディタ拡張：VS Code拡張でCSTMLをパースして構文-awareな検索・差分表示・スニペット展開を実装する価値あり。
- スニペット管理：ギャップ（<//>）＋テンプレートフラグ($)で言語依存のエスケープ問題を回避したスニペットを作れる。
- パーサー連携：既存のパーサー（またはBABLR）をCSTML出力に対応させれば、ツール群の互換性が一気に広がる。
- AST操作：参照タグ（name:, name[]:）を使って部分的な移植・再構築を簡潔に行える。名前空間バインディングで移植時の名前置換コストを下げる。
- まず試すなら：小さな言語・DSLでCSTMLエクスポートを実装し、エディタ内でスニペット＋差分表示を試すと効果が見えやすい。

短時間でプロトタイプを作り、エディタやCIの差分処理に組み込むとCSTMLの利点が実感できます。
