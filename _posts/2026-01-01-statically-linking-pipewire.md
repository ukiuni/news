---
  layout: post
  title: "Statically Linking PipeWire - PipeWire ã‚’é™çš„ãƒªãƒ³ã‚¯ã™ã‚‹"
  date: 2026-01-01T17:58:06.935Z
  categories: [tech, world-news]
  tags: [tech-news, japan]
  source_url: "https://gamesbymason.com/blog/2025/statically-linking-pipewire/"
  source_title: "ðŸ”‰ Statically Linking PipeWire - Games by Mason"
  source_id: 1268904172
  excerpt: "Zigã§dlopenã‚’ç½®ãæ›ãˆã€PipeWireã‚’æ”¹å¤‰ã›ãšé™çš„ãƒã‚¤ãƒŠãƒªåŒ–ã™ã‚‹æ‰‹æ³•ã‚’è§£èª¬"
  image: "https://gamesbymason.com/blog/2025/statically-linking-pipewire/mac.png"
---

# Statically Linking PipeWire - PipeWire ã‚’é™çš„ãƒªãƒ³ã‚¯ã™ã‚‹
é­…åŠ›çš„ãªæ—¥æœ¬èªžã‚¿ã‚¤ãƒˆãƒ«: ã€ŒPipeWireã‚’å‹•çš„ãƒªãƒ³ã‚«ãªã—ã§é™çš„ãƒã‚¤ãƒŠãƒªåŒ–ã™ã‚‹è£ãƒ¯ã‚¶ â€” Zigã§dlopenã‚’â€œç½®ãæ›ãˆã‚‹â€æ–¹æ³•ã€

## è¦ç´„
PipeWire ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…ã¯å¤§é‡ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ dlopen ã§å‹•çš„ã«èª­ã¿è¾¼ã‚€å‰æã«ãªã£ã¦ã„ã‚‹ãŒã€Zig ã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¨ã€Œå½ã®å‹•çš„ãƒªãƒ³ã‚«ã€ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½¿ã†ã“ã¨ã§ã€ä¸Šæµã‚½ãƒ¼ã‚¹ã‚’æ”¹å¤‰ã›ãšã«å®Œå…¨é™çš„ãƒªãƒ³ã‚¯ã® PipeWire ã‚’ç”Ÿæˆã§ãã‚‹ã€‚

## ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¹ãç†ç”±
Linux ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚³ãƒ³ãƒ†ãƒŠã€ã‚²ãƒ¼ãƒ é…å¸ƒã§ã€ŒåŒä¸€ãƒã‚¤ãƒŠãƒªã‚’å…¨ç’°å¢ƒã«é…ã‚ŠãŸã„ã€è¦æœ›ã¯å¼·ã„ã€‚æ—¥æœ¬ã®é–‹ç™ºç¾å ´ã§ã‚‚ musl ãƒ™ãƒ¼ã‚¹ã‚„ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ãƒã‚¤ãƒŠãƒªã®éœ€è¦ãŒå¢—ãˆã¦ãŠã‚Šã€PipeWireï¼ˆç”»é¢ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚„éŸ³å£°çµŒè·¯ã§å¿…é ˆï¼‰ã‚’é™çš„åŒ–ã™ã‚‹æ‰‹æ³•ã¯å®Ÿç”¨çš„ãªè§£æ±ºç­–ã«ãªã‚‹ã€‚

## è©³ç´°è§£èª¬
ãƒã‚¤ãƒ³ãƒˆã¯ã€ŒPipeWire è‡ªä½“ã‚’å¤‰ãˆãšã«ã€å‹•çš„èª­ã¿è¾¼ã¿ APIï¼ˆdlopen/dlsym ç­‰ï¼‰ã®å®Ÿè£…ã ã‘å·®ã—æ›¿ãˆã‚‹ã€ã“ã¨ã€‚

- å•é¡Œç‚¹
  - PipeWire ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼SPA ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯æ•°å¤šãã€å®Ÿè¡Œæ™‚ã« dlopen ã§èª­ã¿è¾¼ã¾ã‚Œã‚‹ã€‚
  - ãã®ã¾ã¾é™çš„ãƒªãƒ³ã‚¯ã™ã‚‹ã¨ã‚·ãƒ³ãƒœãƒ«è¡çªã‚„ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆstatï¼‰ã§å¤±æ•—ã™ã‚‹ã€‚

- ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ¦‚ç•¥
  1. Zig ã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã§ä¸Šæµã‚½ãƒ¼ã‚¹ã‚’ãã®ã¾ã¾å–å¾—ã—ã¦ãƒ“ãƒ«ãƒ‰ï¼ˆfork ã›ãšã«ç®¡ç†ï¼‰ã€‚
  2. dlopen, dlsym, dlclose, dlerror, dlinfo, ã•ã‚‰ã« stat ãªã©ã®æŒ¯ã‚‹èˆžã„ã‚’ç½®ãæ›ãˆã‚‹ã€Œãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°ã€ã‚’ç”¨æ„ã€‚
  3. ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µå®šç¾©ï¼ˆ-Ddlopen=__wrap_dlopen ãªã©ï¼‰ã§ä¸Šæµã‚³ãƒ¼ãƒ‰ãŒå‘¼ã¶åå‰ã‚’è‡ªä½œå®Ÿè£…ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€‚
  4. é™çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã«ã€Œæ“¬ä¼¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ãƒ¼ãƒ–ãƒ«ã€ã‚’ä½œã‚Šã€æ–‡å­—åˆ—åâ†’é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ãƒžãƒƒãƒ”ãƒ³ã‚°ã—ã¦ dlsym ç›¸å½“ã®æ¤œç´¢ã‚’è¡Œã†ã€‚
  5. ç«¶åˆã™ã‚‹åŒåã‚·ãƒ³ãƒœãƒ«ï¼ˆä¾‹ï¼šè¤‡æ•°ã® module_init ã‚„ spa_handle_factory_enumï¼‰ã¯ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µã§ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹åŒ–ï¼ˆæŽ¥é ­è¾žä»˜ä¸Žï¼‰ã—ã¦å›žé¿ã€‚
  6. PipeWire ãŒãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ stat ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹éƒ¨åˆ†ã‚’ãƒ©ãƒƒãƒ—ã—ã€å¿…è¦ãªãƒ‘ã‚¹ã¯ã€Œå­˜åœ¨ã™ã‚‹ã€ã‚ˆã†ã«å½è£…ã™ã‚‹ã€‚
  7. RTLD_NEXT/RTLD_DEFAULT ç­‰ã®ç‰¹æ®Šãƒãƒ³ãƒ‰ãƒ«ã‚„ã€NULL ã‚’æ¸¡ã—ãŸã¨ãã®æŒ™å‹•ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒãƒ³ãƒ‰ãƒ«ï¼‰ã‚‚ä»•æ§˜ã«åˆã‚ã›ã¦å®Ÿè£…ã—ã€dlsym ã®å¤±æ•—ã¯ã‚¨ãƒ©ãƒ¼æƒ…å ±ã§åˆ¤åˆ¥ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

- ãªãœå¯èƒ½ã‹
  - æœ€çµ‚çš„ã« PipeWire ãŒä½¿ã£ã¦ã„ã‚‹ã®ã¯ã€Œã‚ˆãå®šç¾©ã•ã‚ŒãŸ APIã€ã€‚å®Ÿè£…ã‚’å·®ã—æ›¿ãˆã¦åŒã˜å‹•ä½œä»•æ§˜ã‚’æº€ãŸã›ã°ã€å†…éƒ¨ã‚’å¤‰ãˆã‚‹å¿…è¦ã¯ãªã„ã€‚

## å®Ÿè·µãƒã‚¤ãƒ³ãƒˆ
- å¿…ãšä½¿ã„ãŸã„æ©Ÿèƒ½ï¼ˆç”»é¢ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ç‰¹å®šã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç­‰ï¼‰ã§å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼SPA ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã‚’æ´—ã„å‡ºã—ã€æ“¬ä¼¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ã™ã‚‹ã€‚ä½¿ã†æ©Ÿèƒ½ãŒå¢—ãˆã‚Œã°ãƒ†ãƒ¼ãƒ–ãƒ«ã¸è¿½è¨˜ãŒå¿…è¦ã€‚
- ldd ã§ã€Œnot a dynamic executableã€ã«ãªã£ã¦ã„ã‚Œã°é™çš„åŒ–æˆåŠŸã®ç›®å®‰ã€‚
- ä¸Šæµã‚½ãƒ¼ã‚¹ã‚’ç›´æŽ¥å¤‰æ›´ã—ãªã„ãŸã‚ã€PipeWire ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«åˆã‚ã›ã¦ build.zig ã®ä¾å­˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹ã ã‘ã§æ¸ˆã‚€ï¼ˆé‹ç”¨ãŒæ¥½ï¼‰ã€‚
- stat ã‚„ mmap ãªã©ãƒ•ã‚¡ã‚¤ãƒ« I/O ã‚’å½è£…ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ã¯å®‰å…¨æ€§ã¨ãƒ‡ãƒãƒƒã‚°ã®è¦³ç‚¹ã‹ã‚‰ãƒ­ã‚°å‡ºåŠ›ã‚’æ®‹ã™ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆãŒæ¥½ã€‚
- ã“ã®æ‰‹æ³•ã¯ PipeWire ã«é™ã‚‰ãšã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå‹•çš„ãƒ­ãƒ¼ãƒ‰å‰æã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãŒã€API ãŒæ˜Žç¢ºãªã‚±ãƒ¼ã‚¹ã€ã«å¿œç”¨å¯èƒ½ã€‚

å‚è€ƒã®æœ€å°ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆæ¦‚å¿µï¼‰:

```zig
// zig
pub export fn __wrap_dlopen(path: ?[*:0]const u8, mode: c.RTLD) callconv(.c) ?*anyopaque {
    // path == null -> main program handle, otherwise lookup in libs map
}

pub export fn __wrap_dlsym(handle: ?*anyopaque, name: [*:0]u8) callconv(.c) ?*anyopaque {
    // lookup symbol by name in the Lib structure
}
```

## å¼•ç”¨å…ƒ
- ã‚¿ã‚¤ãƒˆãƒ«: Statically Linking PipeWire
- URL: https://gamesbymason.com/blog/2025/statically-linking-pipewire/
