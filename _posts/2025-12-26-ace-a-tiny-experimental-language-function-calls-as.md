---
layout: post
title: "ACE - a tiny experimental language (function calls as effects)"
date: 2025-12-26T04:09:08.307Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://github.com/Lee-WonJun/ACE"
source_title: "ACE - a tiny experimental language (function calls as effects)"
source_id: 438041344
---

# 関数呼び出しが「効果」になる言語 — ACEで見るDI・ミドルウェア・モックの統一モデル

## 要約
ACE（Algebraic Call Effects）は関数呼び出しを「効果（effect）の実行」と見なす試作言語で、インターセプト、依存性注入、ミドルウェア、モックを単一のハンドラモデルで統一することを目指している。

## この記事を読むべき理由
テスト容易性、観測性、プラグイン性が重要な現代のソフトウェア開発において、「呼び出し＝効果」という視点は設計パターンをシンプルにできる。日本のエンジニアが既存のDIやAOP、モック戦略を見直すきっかけになる。

## 詳細解説
- 基本アイデア：通常は「関数呼び出し = 値を計算する操作」だが、ACEでは「関数呼び出し = 効果の実行（performing an effect）」。つまり呼び出しはハンドラによって捕捉・処理されるイベントになる。  
- defnの役割：`defn`宣言は伝統的な意味での関数定義ではなく、効果の宣言（と場合によってはデフォルトハンドラの登録）を行う。
  - 名前が通常の識別子なら効果＋ルートハンドラを定義：`defn add(x,y) : Number { x + y }`
  - バッククォートで囲んだ名前はインターフェース（効果のみ）：`defn \`Print\`(msg) : Unit`
- ランタイムモデル：実行時に「ハンドラスタック」を探索して、どのハンドラがその効果を処理するかを決定する。これにより以下が自然に表現できる：
  - 依存性注入（特定ハンドラで振る舞いを差し替え）
  - ミドルウェア（ハンドラをネストして前後処理を挟む）
  - モック（テスト時にハンドラを差し替えて振る舞いをエミュレート）
- 利点：API設計やテストコードが副作用の発生点（効果）とその取り扱いを分離でき、横断的関心事を言語レベルで扱いやすくなる。実装はまだPoCだが概念実験として示唆が大きい。

例（ACE風の擬似コード）:
```ace
defn add(x, y) : Number { x + y }      // ルートハンドラ付きの効果定義
defn `Print`(msg) : Unit               // インターフェースだけの効果

// 呼び出しは効果の実行
let r = add(2, 3)    // -> perform add effect
`Print`("result: " + r)
```

## 日本市場との関連
- 日本の企業で多く見られるレガシーと新規サービスの混在環境では、「差し替えや観測を容易にする」仕組みが歓迎される。ACEのモデルは、モノリシックなコードベースに対する段階的なテスト導入やリファクタリングにも使える発想を与える。  
- マイクロサービス／サーバーレスや組込み系（IoT）でも、横断的なロギング・リトライ・メトリクス挿入を言語レベルで自然に組み込める可能性がある。

## 実践ポイント
- 試してみる：リポジトリのPoCをクローンして、簡単な効果（ログ、計算、外部呼び出し）を定義してハンドラを差し替えてみる。  
- テストでの活用：ユニットテスト時に実効果をモックする代わりに、テスト専用ハンドラを積むことで外部依存を確実に隔離できる。  
- 設計への応用：既存プロジェクトに導入する前に、ロギングや認可のような横断関心事をACEの効果モデルでリファクタリングする小さなプロトタイプを作る。  

簡単な手順例:
1. リポジトリをチェックアウトしてREADMEのオンラインデモを確認する。  
2. 小さな関数（IOやDBアクセス）を効果に置き換える。  
3. テスト用にハンドラを差し替えて期待される振る舞いを検証する。

## 引用元
- タイトル: ACE - a tiny experimental language (function calls as effects)  
- URL: https://github.com/Lee-WonJun/ACE
