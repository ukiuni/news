---
layout: post
title: "Allowlist for .gitignore - .gitignore の許可リスト化"
date: 2026-01-25T19:08:20.377Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://blog.izissise.net/posts/gitignoreallowlist/"
source_title: "Allowlist for .gitignore"
source_id: 983719227
excerpt: ".gitignoreを許可リスト化し、生成スクリプトで秘密情報や大容量ファイルの誤コミットを防ぐ"
image: "https://blog.izissise.net/posts/gitignoreallowlist/art.png"
---

# Allowlist for .gitignore - .gitignore の許可リスト化
絶対にコミットしたくないファイルをなくす：.gitignoreを「許可リスト」運用に切り替える実践ガイド

## 要約
全ファイルを一旦無視してから「許可するファイルだけ」を明示的に再許可するパターンで、誤コミット（秘密情報や大容量バイナリ、ビルド成果物）を防ぐ。大規模モノレポでは自動生成スクリプトが現実的。

## この記事を読むべき理由
モノレポや複数言語混在リポジトリは日本の開発現場でも増加中。誤って機密や巨大ファイルを含めないための実務的な運用と自動化手法が学べる。

## 詳細解説
- 基本アイデア：まず全てを無視するパターン（/**/*）を書き、次にディレクトリ探索を可能にするため全ディレクトリを許可（!**/）し、最後に追跡したい拡張子や個別ファイルを「!」で再許可する。
- Gitの性質：親ディレクトリが除外されている場合、その下のファイルを再許可できない（Gitはパフォーマンス上、除外されたディレクトリを一覧に出さない）。よって "!**/" などでディレクトリを明示的に許可する必要がある。
- 陥りがちな落とし穴：target/ や node_modules/ のように許可した拡張子を含むが追跡したくない巨大ディレクトリは明示的に除外（deny）しておく。
- 実務上の解決：手動メンテは難しいため、著者は言語別やパス別の許可/除外ルールを組み立てて .gitignore を生成する bash スクリプトを作成。git ls-files --others --ignored --exclude-standard で無視中ファイル確認が可能。
- 生成フローの要点：denyall -> allowalldirs -> 言語別の exts/files 関数でパターンを追加 -> 標準出力を .gitignore にリダイレクトして管理。

短い生成例（出力のイメージ）:
```text
# Generated by gengitignore.sh
/**/* 
!**/
!/.editorconfig
!/.gitignore
!/crate-a/Cargo.toml
!/crate-a/src/**/.rs
!/crate-a/target      # これは実際は deny する想定
```

主要チェックコマンド:
```bash
git ls-files --others --ignored --exclude-standard
git status
```

## 実践ポイント
- ./gengitignore.sh > .gitignore のように生成スクリプトで .gitignore を一元化し、生成物を必ずコミットする。
- 新しい言語/パッケージを追加したらスクリプトにパターンを追加して再生成する。
- target/やnode_modules/など大容量ディレクトリは個別に deny しておく（許可拡張子が混じっても追跡されないようにするため）。
- 新規クローンで git ls-files --others --ignored --exclude-standard を実行し、想定外の無視対象がないか確認する。
