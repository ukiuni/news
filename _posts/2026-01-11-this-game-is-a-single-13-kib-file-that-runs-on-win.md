---
layout: post
title: "This game is a single 13 KiB file that runs on Windows, Linux and in the Browser - Windows・Linux・ブラウザで動く単一13KiBファイルのゲーム"
date: 2026-01-11T23:06:19.972Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://iczelia.net/posts/snake-polyglot/"
source_title: "This game is a single 13 KiB file that runs on Windows, Linux and in the Browser. :: Kamila Szewczyk"
source_id: 46580864
excerpt: "13KiB単一ファイルでWin・Linux・ブラウザで動く驚きのSnakeの作り方と技巧"
---

# This game is a single 13 KiB file that runs on Windows, Linux and in the Browser - Windows・Linux・ブラウザで動く単一13KiBファイルのゲーム
13KBで動く「蛇（Snake）」――1ファイルにWindows/ Linux/ブラウザ版を詰め込む驚きの技術

## 要約
1つの約13KiBファイルに、WinAPI（i686）、ELF（x86_64 Linux）、HTML5/JSの3実装を詰め込み、各プラットフォームでネイティブに動く同一のSnakeゲームを実現した作品の解説記事。

## この記事を読むべき理由
小さな容量で複数プラットフォームに対応する「ポリグロット（polyglot）」技術は、配布・互換性・サイズ制限下での最適化に直結する実務スキル。ゲーム作りやツール配布、競技的プログラミング・デモシーンに興味がある日本のエンジニアや学生にとって学びが多い。

## 詳細解説
- ゲーム内容：古典的なSnake。矢印/WASDで操作、Spaceで開始、Pで一時停止、Rでリセット。得点は通常果実で+10、15%の確率で出る黄色い果実は+20。果実は出現後一定時間で消滅し、消滅時間は当時の蛇の速度（＝長さに比例）に依存。10個取ると次レベルで壁の配置がランダム化される。迷路は必ず蛇の頭から果実まで到達可能な形で生成され、蛇の初期配置も進行方向に少なくとも5マスの余地を確保するようにランダム化される。
- ポリグロットの仕組み：同一ソースから3つの実装を用意（WinAPIのi686用C、X11＋clangのx86_64用C、HTML5 CanvasのJavaScript）。それぞれを圧縮／パッキングし、プラットフォームごとに適切な部分を“拾わせる”ように単一ファイルを構成する。
  - Windows版はPEヘッダの特性を利用して、その領域にシェルスクリプトを忍ばせつつ有効なPEを維持するトリックを使用。初回起動時に互換性ダイアログが出ることがあるが再実行で消える。
  - Linux版はシェルドロッパーでファイル中の圧縮ELFを取り出して一時実行（lzmaで圧縮）。
  - HTML版はブラウザが前方の“ゴミ”を無視して実際のHTMLを解釈する特性を利用。CSSで前段のゴミを視覚的に隠して違和感を無くす工夫あり。
- 最終的に3部分を適切な順序で連結し、各実行環境が自分の担当するバイナリ／HTMLを解釈するようにして、最終ファイルは約13.3KiBになっている（元記事でバイナリ断片やヘッダのダンプも公開）。

## 日本市場との関連性
- 日本のインディーゲーム／ゲームジャム文化や、容量制限のあるコンペ（例：JS13k等）に直接響くアイデア。小容量で魅せる表現は国内のデモシーンや技術展示でも注目されやすい。
- 企業での配布やインストーラ設計でも「1ファイルで複数環境対応」という考え方は応用可能。ただし実行ファイル内に複数形式を詰める手法はセキュリティ製品や社内ポリシーで疑わしく見られる可能性があるため実運用では注意が必要。
- 学習面では、PE/ELFの基本や圧縮・自己展開、ブラウザの柔軟なパース挙動などを理解する良い題材になる（組み込みやクロスコンパイルの知識習得にも有益）。

## 実践ポイント
- まず元記事を読み、作者の実装とアイデア（パッキング手法・HTMLの前方ゴミ利用など）を概観する。
- 小さなゲーム（例：Snake）を題材に、プラットフォーム別に極小実装を作り、結合する手順を試してみると学びが大きい。
- 学ぶべき技術キーワード：PE/ELFヘッダ、lzma（圧縮・復号）、シェルドロッパー、HTMLのパース順序、Canvas描画、最小化・難読化。
- 実運用ではウイルス対策や配布ポリシーに配慮する。パッキングされた実行ファイルは誤検知や配布制限を招きやすい。

元記事と実行ファイルは作者のページで公開されているので、実装の詳細やダウンロードはそちらで確認すると良い。
