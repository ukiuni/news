---
layout: post
title: "Simplifying the build process for vst3-rs"
date: 2025-12-26T20:54:02.724Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://micahrj.github.io/posts/vst3/"
source_title: "Simplifying the build process for vst3-rs"
source_id: 737712605
excerpt: "vst3-rs 0.3で生成済みバインディング同梱、SDK/libclang不要で導入とCIが高速化"
---

# VST3のRustバインディングが劇的に簡単に──vst3-rs 0.3.0で何が変わったか？

## 要約
SteinbergのVST 3 SDKがMIT化されたのを受け、vst3-rs 0.3.0ではビルド時のバインディング生成と外部依存（libclang + VST3 SDK）が不要になり、生成済みバインディングをクレートに同梱してセットアップとビルド時間を大幅に改善した。

## この記事を読むべき理由
日本のプラグイン開発者やDAW連携エンジニアにとって、ライセンスの不安や複雑なビルド環境は実務上の障壁になりがち。今回の変更で「閉源プラグインでも使える」「開発環境のセットアップが楽になる」「CIが速くなる」といった即効性のあるメリットが得られる。

## 詳細解説
- 背景：VST 3はC++ヘッダ群として提供され、従来vst3-rsはlibclangでそのヘッダを解析してビルド時にRustバインディングを自動生成していた。この方式はlibclangとSDKの入手／ライセンス管理を利用者に委ねる必要があった。
- ライセンスの転換：2025年10月にSteinbergがVST 3 SDKをMITライセンスで公開したため、バインディングをクレートに含めて配布しても法的問題が解消された。これが今回の機能同梱を可能にした決定打。
- 技術的課題：libclangの出力はターゲットプラットフォーム依存（プリプロセッサ分岐やツールチェーンの挙動差）で、Windows/macOS/Linuxで生成結果に差が出る。実際に見つかった違いは、出力順序、<cstdint>の固定幅整数のマッピング、一部定数値（result codes）、enumの基底型など。
- 解決策：ターゲット毎に異なる出力をそのまま配布する代わりに、CIで各プラットフォームの生成結果がバイト単位で同一であることを検証し、差分を潰す修正を繰り返して統一した生成物を作成した。結果として生成ステップを事前に行い、生成済みバインディングをクレートに含めて配布する流れに移行した。

## 実践ポイント
- すぐやること：
  - Cargo.tomlで vst3 = "0.3" 系にアップデートして試す（v0.3.0以降に生成済みバインディングが同梱）。
  - ローカル開発環境から libclang と VST3 SDK の必須インストールを外して動作確認する（既存プロジェクトのビルド手順が簡素化される）。
- CI周り：
  - ビルド時間が短縮されることを活かしてテストマトリクスを広げる（ターゲット別ビルド数を増やせる）。
  - 既存で独自に生成したバインディングを使っている場合は、生成物を新バージョンに置き換えて差分を確認する。
- ライセンス確認：
  - MIT化によって配布上の制約は緩和されたが、プロジェクトポリシーや社内コンプライアンスに合わせて最終確認を行うこと（商用閉源プロジェクトでの利用も現実的に容易になった）。
- トラブルシュート：
  - もしターゲット固有の不具合が出る場合は、vst3-rsのIssueやCIの出力（どの差分を潰したか）を参照すると原因特定が速い。

