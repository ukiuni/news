---
layout: post
title: "Break Me If You Can: Exploiting PKO and Relay Attacks in 3DES/AES NFC - 「壊してみろよ！」：3DES/AES NFCにおけるPKOとリレー攻撃の悪用"
date: 2026-01-29T15:55:53.026Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://www.breakmeifyoucan.com/"
source_title: "BREAKMEIFYOUCAN! - Exploiting Keyspace Reduction and Relay Attacks in 3DES and AES-protected NFC Technologies"
source_id: 46810536
excerpt: "NFCホテル鍵がリレー＋部分上書きで数分〜数週で復元、112bitが実質28bit相当に"
image: "https://breakmeifyoucan.com/og-image.png"
---

# Break Me If You Can: Exploiting PKO and Relay Attacks in 3DES/AES NFC - 「壊してみろよ！」：3DES/AES NFCにおけるPKOとリレー攻撃の悪用
ホテルのルームキーや簡易チケットが数分〜数週間で鍵を復元され得る衝撃の調査を分かりやすく解説

## 要約
NFCのMIFARE Ultralight C／Ultralight AES／NTAG 223/224 DNAや非NXP互換カードに、リレー攻撃・部分キー上書き（partial key overwrite）・EEPROM“tearing”を組み合わせることで、実運用で暗号鍵の総当たりを現実的に可能にする脆弱性が確認された。研究では理論的なキー空間縮小で $2^{112}$ が事実上 $2^{28}$ 程度にまで削れる例が示される。

## この記事を読むべき理由
- 日本でもホテル鍵、イベント入場券、交通・シングルチケット用途で類似カードが使われており、設定ミスや偽造カード混入で実被害につながる可能性が高い。  
- 脆弱点は暗号アルゴリズム自体の破綻ではなく、プロトコル設計・実装・運用設定の不備に起因するため、対策でリスク低減が可能。

## 詳細解説
- 影響対象：NXPのMIFARE Ultralight C（MF0ICU2）、Ultralight AES（MF0AES）、NTAG 223/224 DNA系、および Giantec/Feiju 等の非NXP互換UL-Cチップ群。  
- コア問題：認証後のメッセージに対する整合性検証（後続コマンドのMACや暗号化）が欠如しているため、認証をリレーで通過させた後にタグへ任意の書き込みを行える。さらに、キーが複数ページに分散して保存され書き込みが原子性を欠くため「部分上書き」が成立する。  
- 代表的攻撃手順（Ultralight C）：キー（112-bit 2TDEA）が4ページに分散 → 攻撃者は認証をリレーで通し、3ページを既知値に上書き → 残る28ビットを総当たり → 複数タグで各区画を抜き出し結合して完全鍵を復元。これにより計算量は理論上の $2^{112}$ から実質上 $4\times 2^{28}$ 相当まで低下する。  
- NTAG 223/224 DNA系では、SUN（Secure Unique NFC）メッセージに対するCMAC計算や整合性が不適切だと、暗号化されたデータからオラクル的に鍵情報を得られ、単一タグで短時間に鍵を回収可能。  
- 非NXPカードはPRNGやアンチテアリング欠如でさらに致命的。研究では一部カードでスマホ級の計算力で単体60秒未満で鍵回復が可能と報告。  
- 必要機材とコスト感：Flipper Zero・Proxmark3 等の安価な機器でリレーや認証試行が可能。総費用は概ね数百ドル以下で現実的な脅威。

## 実践ポイント
- まず監査：自社発行カードのチップメーカー（UID・チップ指紋）、キー運用（静的か多様化か）、鍵ページのロック状態、Ultralight AESならSEC_MSG_ACT（CMAC）やAUTH_LIMが有効かを確認する。  
- すぐできる対策：
  - キー多様化（UID＋サイト固有ソルトをKDFにかける）を導入する。  
  - キーページをパーソナライズ後に恒久ロックする（可能なら即ロック）。  
  - Ultralight AESでは必ずCMAC（SEC_MSG_ACT）を有効化し、認証試行上限（AUTH_LIM）を設定する。  
  - 供給チェーン監査で非NXP互換カードを排除する（UID等でフィンガープリント）。  
- 長期対策：高セキュリティ用途はMIFARE DESFire EV3等、エンドツーエンド暗号化と整合性保護を標準で持つ製品へ移行する。  
- 運用面：廃棄カードの管理を徹底し、カード紛失報告と即時無効化のルールを定着させる。  
- 参考：研究チームはGitHubにPoCツールを公開しており、監査・検査に利用可能（公開リポジトリ参照）。

— 以上。原論文とPoCは1月公開で、NXPとも事前調整済み。現場での実装・運用の見直しが急務です。
