---
layout: post
title: "On the Promises of 'High-Assurance' Cryptography - 「『高保証』暗号の約束」"
date: 2026-02-05T20:29:56.259Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://symbolic.software/blog/2026-02-05-cryspen/"
source_title: "On the Promises of &#39;High-Assurance&#39; Cryptography &bull; Symbolic Software"
source_id: 817068188
excerpt: "形式検証済みとされた暗号ライブラリが複数の実装欠陥で崩壊、信頼の盲点を暴く"
image: "https://symbolic.software/images/graphicH.png"
---

# On the Promises of 'High-Assurance' Cryptography - 「『高保証』暗号の約束」

魅惑的タイトル: 形式検証で“安全”と言われた暗号ライブラリが静かに壊れた話 — 本当に信頼できるのは何か？

## 要約
形式検証をうたうCryspenのlibcruxで、プラットフォーム依存の暗号出力誤差や仕様違反など複数の重大欠陥が見つかった。検出後の公開対応も乏しく、「高保証」表記の実態に疑問が投げかけられている。

## この記事を読むべき理由
- 日本でもRustや組み込みARM環境、暗号ライブラリを使うサービスは増加しており、プラットフォーム依存の不具合は直接的な認証失敗や鍵共有破綻を招く。  
- 形式検証が「万能」の保証ではないことを理解し、実運用でのリスク管理と検査ポイントを知る必要がある。

## 詳細解説
- 元の問題（2025年11月）：libcrux-ml-dsaが実行環境（Alpine+Ampere ARM64 と macOS Apple Silicon）で同じシードから異なる公開鍵・署名を生成。原因は、SHA-3用のvxarq_u64命令が無い環境向けのフォールバック実装が誤った引数を渡していたためで、ダイジェストが壊れて下流処理が静かに失敗していた。  
- 開示の欠如：Cryspen自身は公的なセキュリティアドバイザリを出さず、第三者がRustSecに登録したのみ。ユーザーには通知されないまま修正が入った点が問題視される。  
- Symbolicが報告した追加4件（2026年2月）：
  1. X25519の全ゼロ共有秘密チェック欠如（hpke-rs）：RFC 9180が要求する「共有秘密が全ゼロなら中止」を実装しておらず、悪意ある公開鍵で鍵導出が予測可能に。対策は共有秘密の比較チェック。  
  2. シーケンス番号オーバーフローによるノンス再利用（hpke-rs）：シーケンスをu32で管理し、RFCのノンス上限 $2^{96}-1$ と比較していなかった。u32上限は約 $2^{32}-1$ であり（約4.29×10^9）、本番ビルドではラップしてノンス再利用が発生しうる。対策は checked_add 等でオーバーフロー検出。  
  3. ECDSA（P-256）署名のmalleability（libcrux）：low-S 正規化を行っておらず、(r, s) と (r, n−s) の両方が有効になってしまう。トランザクションIDや監査で問題を引き起こす。対策は s ≤ n/2 に正規化または検査。  
  4. Ed25519での二重clamping（libcrux）：RFC 8032ではハッシュ後にclampするが、ライブラリは生のシードにclampを適用し5ビット分エントロピーを削っていた。仕様通りハッシュ後に処理すべき。  
- 問題の本質：形式検証は「抽象モデル」やRustレイヤーの性質を保証できるが、コンパイラ、intrinsics、ハードウェア、ランタイムなど周辺要素までは保証しない。今回の多くは仕様無視や基本的な実装不備であり、形式検証だけでは防げないクラスのバグが多い。

## 実践ポイント
- 依存ライブラリの監査：cargo audit 等で脆弱性データベースを定期チェックする。  
- マルチアーキテクチャテスト：ARM/Intel等複数プラットフォームで暗号動作を検証する。  
- 仕様チェックの自動化：HPKEの全ゼロチェック、ECDSA low-S、Ed25519のclamp位置など仕様遵守を単体テストに組み込む。  
- 整数操作は安全に：カウンタ増加は checked_add 等でオーバーフローを明示的に処理。  
- 開示ポリシーを確認：暗号ライブラリは不具合時の通知・アドバイザリを出すかを導入前に確認する。  
- 「形式検証」の意味を理解：宣伝文句を鵜呑みにせず、どこまで検証対象か（モデル、ビルド、環境）を明確にする。

短く言えば、形式検証は有力なツールだが、それだけで「高保証」になるわけではない。実装仕様への忠実さ、クロスプラットフォーム検証、透明な開示が同等に重要だ。
