---
layout: post
title: "Nested Code Fences in Markdown - Markdownにおけるネストされたコードフェンス"
date: 2026-01-21T14:32:04.885Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://susam.net/nested-code-fences.html"
source_title: "Nested Code Fences in Markdown - Susam Pal"
source_id: 46705201
excerpt: "コード内の```を安全にネストする方法とツール別注意点を実例で解説"
---

# Nested Code Fences in Markdown - Markdownにおけるネストされたコードフェンス
Markdownで「```」に挟まれた罠を回避する——バックティックを安全にネストするテクニック

## 要約
Markdownでコードブロックやインラインコードにバックティック（`）やチルダ（~）を含めると、フェンスが想定どおり閉じられず表示が崩れることがある。CommonMark（および GFM）では回避方法が仕様で定められており、簡単なルールで安全にネストできる。

## この記事を読むべき理由
README・技術ブログ・ドキュメント作成時、コード例に「```」やバックティックを含めたい場面は頻繁に出る。誤ったフェンスの使い方でレンダリングが壊れると読者が混乱するため、確実な対処法を知っておくと日本の開発現場でも役立つ。

## 詳細解説
- フェンス（fenced code blocks）  
  - CommonMarkでは、コードブロックは「少なくとも3つの連続したバックティック (`) またはチルダ (~)」で囲む。開始に使った種類（` または ~）と同じ種類で、開始より少なくとも同数の文字を持つ閉じフェンスが必要。  
  - そのため、コード内に3つのバックティックが現れると、外側の ``` がそこで閉じられてしまい本来の内容が外に出ることがある（意図せず分断される）。
  - 回避法（サンプル）:
    - フェンスをチルダで囲む（中に ``` を入れられる）:

```markdown
~~~ 
``` 
(o_o)--.|[_]| 
~~~ 
```

    - または外側のフェンスをバックティックで書く場合、開始・終了を4個以上にする（開始と同数以上で閉じる）:

```markdown
`````
``` 
(o_o)--.|[_]| 
````` 
```

- インラインコード（code spans）  
  - インラインコードもバックティック列（1個以上）で始まり同じ長さのバックティック列で終わる。つまり中にバックティックを含めたいときは、区切りのバックティック個数を増やせば良い。  
  - 例: テキスト中に `` `(o_o)` `` のように二重バックティックで囲むと、内部の単一バックティックがそのまま表示される。  
  - 余談：コードスパン内の先頭/末尾にスペースがある場合、先頭末尾の一つずつのスペースが削られる（ただし全体が空白だけのときは別）。

- 実装差異に注意  
  - CommonMark が基準。GitHub Flavored Markdown (GFM) は CommonMark の上位互換なので、ここでのルールは GitHub README 等にも当てはまる。だがその他ツール（CMS、チャットツール、静的サイトジェネレータ等）で微妙な差異があるため、公開先でプレビューして確認するのが安全。

## 実践ポイント
- ドキュメントに「```」を含むコードを埋め込むときは、外側をチルダ（~~~）にするか、外側のバックティック数を中にあるものより多くする。  
- インラインでバックティックを表示したいときは、区切りを複数のバックティックで囲む（例: `` `(code)` ``）。  
- 常に動作確認を：GitHub/GitLab/Notion/Slackなど公開先でレンダリングを確認する。ツールによっては独自拡張がある。  
- README・技術ブログのテンプレートにこのルールをメモしておくと、共同作業での誤解を減らせる。

以上の小さなルールで、Markdownの「フェンス事故」を簡単に防げる。ドキュメントを書くときに一度チェックリスト化しておくと便利。
