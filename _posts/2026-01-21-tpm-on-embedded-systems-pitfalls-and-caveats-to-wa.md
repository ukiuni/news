---
layout: post
title: "TPM on Embedded Systems: Pitfalls and Caveats to Watch Out For - 組み込み向けTPM：注意すべき落とし穴と留意点"
date: 2026-01-21T16:43:25.489Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://sigma-star.at/blog/2026/01/tpm-on-embedded-systems-pitfalls-and-caveats/"
source_title: "TPM on Embedded Systems: Pitfalls and Caveats"
source_id: 46676919
excerpt: "組み込みTPM導入で陥りやすい物理攻撃・fTPM脆弱性・更新地獄を回避する実践要点"
image: "https://sigma-star.at/assets/images/opengraph/og-image-blog-security.png"
---

# TPM on Embedded Systems: Pitfalls and Caveats to Watch Out For - 組み込み向けTPM：注意すべき落とし穴と留意点
組み込み機器にTPMを入れる前に知っておきたい「物理」「ソフト」「運用」の落とし穴

## 要約
TPM（Trusted Platform Module）は組み込み機器でも有用だが、物理攻撃やバス傍受、fTPM/TEEの脆弱性、長寿命製品に伴う更新問題など特有のリスクがある。設計・運用で注意すべき点を整理する。

## この記事を読むべき理由
日本の組み込みメーカーやIoT開発者は、現場で物理的に晒される機器が多く、TPMを導入すると見た目の安全性は上がるが誤った使い方で逆に危険になる。規制（CRA、NIS2）対応や長期サポート計画を含め、現実的な導入判断が必要だから。

## 詳細解説
- TPMの基本用途
  - 秘密鍵/シークレットの保護（鍵階層、バインディング／シール）
  - 測定ブート（PCRとイベントログによるブート状態の記録）
  - （リモート）アテステーション（Quoteによる証明）

- 組み込み特有の違い
  - 多くはArm SoC＋カスタムブートROM／U-Bootで、PCのUEFIと異なる流れ。
  - 物理的に無人で置かれることが多く、改ざんやサイドチャネル、フォルト注入のリスクが高い。
  - 製品寿命が長く、TPMやTEEの脆弱性に対する長期対応が必須。

- 主な落とし穴
  1. バス傍受（LPC/SPI/I2C）
     - TPMセッション暗号化をクライアント側で有効にしないと平文が露出する。
  2. アクティブなインターポーザ／リセット攻撃（MitM・TOCTOU）
     - TPMリセットを悪用してPCRを作り直す攻撃があり、カーネルのNULLシード連携など新対策があるが、ユーザランド側やsystemd連携は追随が必要。
  3. 物理破壊・取り外し攻撃
     - ISO/IEC 19790の高レベル認証が取れているTPMは稀。ハードウェア単体に過度に依存しない設計が必要。
  4. 実行中コードの脆弱性
     - TPMは受動的で、OS上の悪コードが正しい認証情報を与えれば動作する。測定ブート・起動後のIMA/EVM等でランタイム保護が不可欠。
  5. ハードウェア欠陥（例：ROCA）と長寿命問題
     - TPM実装の致命的欠陥はデバイス全体の安全性を損なうため、更新計画と鍵管理の分散化が重要。
  6. ソフトTPM（fTPM）とTEEの落とし穴
     - fTPMはバス攻撃を排する一方で、TEEやストレージ鍵導出の実装問題やサイドチャネルで破られる場合がある（TPM-FAIL、faulTPM等）。

## 実践ポイント
- 通信保護：TPMセッション暗号化（コマンド/レスポンス）を必ず有効化する。
- バス排除：可能ならfTPM（同一SoC内）を採用して物理バスの露出を減らすが、TEEの堅牢性を確認する。
- 測定・検証：測定ブートを導入し、PCRに基づく鍵シールとリモート／ローカルアテステーションを組み合わせる。
- カーネル連携：NULLシード等のカーネル側対策を利用し、ユーザランドでの完全な検証フローを実装する（systemd連携の動向に注意）。
- ランタイム防御：IMA/EVMやSELinux/AppArmorで実行時の改ざん・権限昇格を抑制する。
- 鍵設計：デバイス毎にユニーク鍵、可能な限り鍵の有効期限・使用制限を設定。鍵を使い終わったらPCRで無効化する工夫。
- 物理対策と認証選定：設置環境に応じた筐体／タンパー対策と、必要に応じて高い物理認証レベルのモジュール選定を検討する。
- 運用とサプライチェーン：TPM/TEEベンダーのアップデート対応を確認し、脆弱性発覚時の回避策（鍵ローテーション、バックエンド分離）を計画する。

短期的には「セッション暗号化をONにする」「鍵をPCRで使い捨てにする」だけでもリスクを大きく下げられます。組み込みの現場ではハード・ソフト・運用を横断して設計することが最重要です。
