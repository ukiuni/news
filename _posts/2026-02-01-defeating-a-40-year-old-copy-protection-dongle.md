---
layout: post
title: "Defeating a 40-year-old copy protection dongle - 40年もののコピー保護ドングルを破った話"
date: 2026-02-01T23:03:04.694Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://dmitrybrant.com/2026/02/01/defeating-a-40-year-old-copy-protection-dongle"
source_title: "Defeating a 40-year-old copy protection dongle &#8211; Dmitry Brant"
source_id: 46849567
excerpt: "40年物の並列ポートドングルを4バイトパッチとブルートフォースで解除し古い会計ソフトを復元"
---

# Defeating a 40-year-old copy protection dongle - 40年もののコピー保護ドングルを破った話
40年モノの並列ポート・ドングルを4バイトで破ったソフトウェア考古学の話

## 要約
旧RPG系会計ソフトが動作を拒む「並列ポート接続のハードウェアドングル」を、バイナリ解析と最小パッチ＋ブルートフォースで無効化してソフトを復元した事例を紹介します。

## この記事を読むべき理由
いまでも国内の中小企業や組織に残るレガシー資産（古い会計/業務ソフト）を安全に移行・復元する際に直面する実務的な課題と、解析手法の実践例が得られます。

## 詳細解説
- 背景: IBM系RPGで作られ、MS‑DOS移植された古い会計ソフト。実機はWindows 98上のDOS窓で動作し、動作には並列ポート（LPT1）に刺さるハードドングルが必須だった。  
- 調査手順:
  - まずPCイメージを取得してエミュレータ（DosBox等）で再現。
  - 実行ファイルを再配置・逆アセンブルにRеkoを使用。16ビット実行形式を解析し、実際のI/Oは別セグメント（例: 0800h）にあることを発見。
  - セグメント内にin/out命令があり、並列ポートのデータ/ステータスを読み書きしてBX（BH:上位, BL:下位）に結果を蓄積、最後にRETFで呼び出し元へ返す単独ルーチン。
- キーメカニズム:
  - ルーチンは引数を取らず、外部入力がないため戻り値(BX)は常に一定であることを理詰めで導出。
  - 先頭を即帰還させる4バイトパッチでBXに定数を設定する手法を採用。x86バイト列で例: BB 06 76 (MOV BX,7606h) と CB (RETF)。
  - BLは8ビットで256パターンしかないため、プログラム的にBLを総当たりして正解を探す（DosBoxを自動起動して出力を確認）。正解は 0x7606。
- 追加発見:
  - コンパイラ側（RPGC.EXE）自体も同じルーチンを持ち、コンパイル時にこのルーチンを生成物へコピーしていたため、コンパイラをパッチすれば以降の生成物もドングル不要になる。

## 実践ポイント
- 手順まとめ:
  1. まずディスクイメージを取得してエミュレータで安全に再現する。オリジナル環境は壊さない。  
  2. 実行ファイルを逆アセンブル（Reko等）し、I/O命令やセグメント分割を注視する。  
  3. コピー保護ルーチンの入出力・戻り値の仕様を論理的に導く（引数が無ければ定数化の可能性が高い）。  
  4. 最小パッチで即帰還させ、必要なら下位バイトをブルートフォースして正解を見つける。  
  5. コンパイラやツールチェイン側をパッチすれば派生実行ファイルも解放できる。  
- 注意点:
  - 法的・倫理的側面を確認する（ソフト所有者や権利者との合意が前提）。  
  - データ（顧客情報等）の扱いは厳重に。公開する際はPIIを必ず除去する。  
- 日本向け示唆:
  - 製造業・士業・会計事務所などで古いソフトが現役のケースが多い。移行計画に解析とエミュレーションを組み込むと安全にデータ移行できる可能性が高い。

以上。必要なら解析で使った最小パッチ例や自動化スクリプトの雛形を提示します（公開前に法的確認をお勧めします）。
