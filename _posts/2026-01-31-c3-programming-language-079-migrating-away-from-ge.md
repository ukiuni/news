---
layout: post
title: "C3 Programming Language 0.7.9 - migrating away from generic modules - C3 0.7.9：モジュールベースのジェネリクスから“グループ”へ、オプショナル構文も刷新"
date: 2026-01-31T22:30:57.797Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://c3-lang.org/blog/c3-0-7-9-new-generics-and-new-optional-syntax/"
source_title: "C3 | Blog | An evolution, not a revolution"
source_id: 412533518
excerpt: "C3 0.7.9：ジェネリクスを宣言グループ化、?を~に変更し互換性維持で移行可能"
---

# C3 Programming Language 0.7.9 - migrating away from generic modules - C3 0.7.9：モジュールベースのジェネリクスから“グループ”へ、オプショナル構文も刷新
C3のジェネリクスとオプショナル構文が大幅に軽量化・整理されたマイナーアップデート。互換性を保ちつつマクロ依存を減らす狙いの変更です。

## 要約
ジェネリクスは「モジュール毎」から「同名引数でグルーピングする宣言群」へ移行し、オプショナル値の作成用サフィックスは`?`から`~`へ変更（型表現の`?`はそのまま）。その他、カスタム libc、NetBSD サポート、反射短縮、暗号・stdlib強化、約120のバグ修正を含みます。

## この記事を読むべき理由
- C3で型安全な汎用コードを書く人は、ジェネリクスの記法とインスタンス化ルールが変わるため必読。  
- 大規模コードやライブラリを保守していると、マクロ依存を減らせるため移行の価値が高い。  
- オプショナル生成のサフィックス変更は互換性に影響するため、短時間で対応が必要です。

## 詳細解説
- 新しいジェネリクス（グループ型）
  - 旧来は「generic module」を単位にして、1つの型インスタンス化でモジュール内の全シンボルが生成される方式。中心化されたチェックは利点だが、モジュール単位の粒度が重くマクロに依存しがちでした。
  - 0.7.9では「モジュール内で同じ引数名を使う宣言群」が1つのジェネリック・グループになる。グループに属する宣言はまとめてインスタンス化され、グループごとに制約を共有できます（関数・マクロは例外的に別扱い）。
  - 例（簡略化）：
    ```c3
    // Group 1
    fn Type foo(Type t) <Type> { return t * 2; }
    fn Type bar(Type a, Type b) <Type> { return a * b; }

    // Group 2
    fn OtherType baz(OtherType a, OtherType b) <OtherType> { return a / b; }

    // foo{int}(1) を呼ぶと foo と bar が int でインスタンス化され、baz はされない
    ```
  - モジュール宣言にパラメータを付ける書き方（例: `module my_generic <Type>;`）は旧方式との互換性を保ちます。
  - 推奨：既存のモジュール型ジェネリクスは段階的にグループ宣言へ移すことでマクロ依存を減らせます。

- 型制約と推論
  - 同じグループ内の宣言は制約を共有可能（例：ビット幅や符号など）。ただし関数／マクロ宣言はグループ制約から除外される場合があります。
  - 完全な一般推論はまだ限定的。代入時に代入先の型に合わせてインスタンス化が推論されるケースはありますが、明示指定が必要な場面も多いです。

- オプショナル生成の構文変更
  - 値をオプショナル（fault→Optional）にする旧サフィックス`?`は曖昧さや文法衝突があり、`~`へ変更（`int ? x = io::EOF~;`）。
  - 「即時再スロー／パニック」演算子（旧 `?!` / `?!!`、いわゆる“nani”）は `~!` / `~!!` に変わります。
  - 注意：型注記における `?`（例 `int?` のようなオプショナル型表現）は変更されません。

- その他の注目点
  - --custom-libc オプションで「stdlibはlibcありで振る舞うが自動リンクはしない」ビルドが可能。組込みや代替 libc を使うケースで有用。
  - NetBSD 対応強化、WindowsでのUTF-8コンソール出力有効化（デフォルト）。
  - 反射の短縮：`foo.$abc` は `foo.eval("$abc")` の簡潔形に。
  - 新しい組込み：整数↔ビットマスク変換や、アンアラインドロード/ストアの拡張、コンパイラ版情報の `$$VERSION`/`$$PRERELEASE` など。
  - 暗号・ハッシュ系の追加（Poly1305, Ripemd, Chacha20, Blake2/3, streebog）および多数の stdlib 機能追加・整理。
  - マルチレベル配列長推論（例 int[*][*]）は非推奨に。実装コストとバグの多さが理由。

## 実践ポイント
- まずはCIでコンパイラを0.7.9に切り替え、テストを全走行すること。オプショナルの生成（`?`→`~`）は自動置換スクリプトで対応するのが現実的。
- モジュールベースのジェネリクスを使っている箇所は次の手順で移行：
  1. 同一モジュール内のジェネリック宣言が同じ型引数名か確認。
  2. 必要なら `module Name <Type>;` を使って互換性を保ちながら段階的にグループ化。
  3. マクロで生成しているジェネリクスはグループ化で置き換えられるか検討。
- 非推奨API（スレッド系の一部戻り値など）をチェックし、将来の0.8.0に向けて修正を計画。
- 新反射短縮やビルトイン関数を利用してコードを簡潔に。`$$VERSION` 等はビルド情報埋め込みに便利。
- 組込み／独自 libc を使う場合は `--custom-libc` を試し、リンク周りを確認。
- 大量の修正が含まれるため、境界ケースの単体テスト（オプショナル、配列長、アンアラインドアクセス、シリアライズ周り）を重点的に回す。

アップデートは互換性に配慮した設計ですが、オプショナル作成とジェネリクスの挙動に関わる変更は動作に影響しやすいので、早めの確認とテストをお勧めします。
