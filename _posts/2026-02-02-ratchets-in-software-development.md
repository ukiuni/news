---
layout: post
title: "Ratchets in Software Development - ソフトウェア開発におけるラチェット"
date: 2026-02-02T09:20:46.427Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://qntm.org/ratchet"
source_title: "Ratchets in Software Development"
source_id: 46814340
excerpt: "CIのLintで禁止パターンを閾値管理し段階的に削減、レガシー悪習を封じる"
image: "https://qntm.org/page/favicon.png"
---

# Ratchets in Software Development - ソフトウェア開発におけるラチェット
増やさない・戻さない——「ラチェット」でレガシー悪習を静かに封じる方法

## 要約
ラチェットとは、lint 時にコードベースから「使わないでほしいパターン」を数え、許容数を超えたらエラーにする単純な仕組み。徐々に廃止を促し、コピー＆ペーストによる再導入を防ぐ運用手法。

## この記事を読むべき理由
既存コードに残る悪い使い方は新人を迷わせ、レビューを無駄にする。日本の現場でも古いライブラリAPIや社内SDKの非推奨利用が残りやすく、本記事の手法は低コストで効果を出せる。

## 詳細解説
- 基本動作：ソースコードをテキストで走査し、禁止したい「文字列パターン」（例：特定メソッド名）を数える。許容数はスクリプトにハードコーディングされ、超過でビルド/PRを失敗させる。逆に数が少なくなれば「おめでとう」として閾値を下げるよう促す。
- 実装は単純：高度な AST パースは行わず、単純な文字列マッチや将来的に正規表現を使う想定。スクリプト自身は走査対象外にする必要がある。
- 効果と限界：新たな例の拡散を自動で止めるのに有効だが、既存の残骸を自動で消すわけではない。運用で閾値を手動で調整したり、一時的に増やすこともある。誤検出（コメントや文字列内の言及）への対策は現状限定的。
- 注意点：ルール追加の濫用に注意。厳しすぎる基準は創造性やチームの柔軟性を奪う。ファイル単位での例外化や段階的な封じ込み（サブディレクトリごとの閾値）も有効。

## 実践ポイント
- 導入手順
  1. 廃止したいパターン（メソッド名、API、フラグ）をリスト化する。
  2. 現状の件数をカウントして閾値を設定（まずは現状と同じ数に）。
  3. CI の lint フェーズでカウントチェックを実行、超過で PR をブロック。
  4. 徐々に閾値を下げ、チームで残件を潰していく。
- 運用のコツ
  - スクリプトは簡潔に保つ。過度な機能追加はコスト源になる。
  - コメントや特定ファイルを除外する設定を用意する（必要ならファイル単位の免除リスト）。
  - チームに目的を共有し、ルール化の濫用を防ぐガバナンスを設ける。
  - 将来的には正規表現や自動修正提案、より親切なエラーメッセージを検討する。

この手法は大がかりなリファクタやツール投資なしに、コード品質の悪習拡散を抑える実践的な一手になる。
