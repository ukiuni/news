---
layout: post
title: "How an inference provider can prove they're not serving a quantized model - 推論プロバイダが量子化モデルを提供していないことを証明する方法"
date: 2026-02-21T20:41:11.143Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://tinfoil.sh/blog/2026-02-03-proving-model-identity"
source_title: "Tinfoil - How Tinfoil Proves Exactly What Model Is Running"
source_id: 47098172
excerpt: "Merkle木＋dm-verity＋エンクレーブでモデルが改変・量子化されていないことを証明"
image: "https://tinfoil.sh/blog-images/2026-02-03-proving-model-identity.jpg"
---

# How an inference provider can prove they're not serving a quantized model - 推論プロバイダが量子化モデルを提供していないことを証明する方法
魅せるタイトル: 「本当にその重み？――APIで“同じモデル”が返ってくることを暗号的に証明する方法」

## 要約
Tinfoilが公開したModelwrapは、モデルの重みが配信時に改ざん・量子化されていないことを、Merkle木＋dm-verity＋エンクレーブ（起動時の証明）でランタイムまで保証する仕組みです。

## この記事を読むべき理由
クラウド推論で「指定したモデルが本当に使われているか」は日本の企業にも重要な問題です。品質や法令順守、再現性、コスト最適化の観点から、モデルの“実物”を確認できる技術は国内導入価値が高いです。

## 詳細解説
- 問題点：ハードウェアの起動時だけを証明する従来のアテステーションは、起動後にディスクから読み込まれる重み（weights）を保証しません。つまり、プロバイダが公開重量（公開ウェイト）と異なる量子化版や改変版を配っても検出できない危険があります。
- 基本アイデア：重みファイル全体をMerkle木でハッシュし、得られたルートハッシュを公開コミットメントとして使う。kernel側でdm-verityを設定し、OSがディスク読み出し時に各ブロックの整合性を検証するようにする。ルートハッシュはカーネルコマンドライン経由でエンクレーブの計測（attestation）に含める。
- 主な構成要素
  - Merkle Tree：大規模（例: 100GB超）のモデルを小さな固定長ハッシュ（ルート）でコミット可能。ブロック単位で検証可能。
  - dm-verity：Linuxカーネルの仕組みで、read()ごとにブロックハッシュを検証。改ざんがあればI/Oエラーで読み出し不能にするため、アプリ側（vLLMなど）を改造不要で保証できる。
  - エンクレーブ + 起動時アテステーション：カーネルコマンドラインに渡したルートハッシュを含めて起動計測することで、「このエンクレーブはそのルートハッシュに縛られている」ことを証明。
- Modelwrapの手順（簡潔）
  1. モデルを決まったコミットでダウンロードし正規化、EROFS（読み取り専用FS）イメージ化。
  2. veritysetupでMerkle木を作り、ルートハッシュを算出して.mpkとして梱包。
  3. ルートハッシュをカーネルに渡し、起動アテステーションで証明。動作時はdm-verityが全ブロック読み出しを検証。
- 公開モデル vs プライベートモデル：公開モデルなら誰でも同じコミットで再現検証できる。プライベート重みでも、自分でイメージを作ってルートをアテステーションに含めれば「中身を見せずに同一性を保証」できる。秘密保持が必要ならdm-cryptでディスクを暗号化し、鍵をエンクレーブへのみ提供する手法も説明されています。
- 性能とコスト：dm-verityのハッシュツリーはサイズオーバーヘッド約0.8%程度。コールドロード（初回ディスク読み出し）では最悪で約80%遅くなるが、これはサーバ起動時のみで、GPUに展開後は通常性能に戻る点が要注意。

## 実践ポイント
- プロバイダ選定時に「起動時アテステーション＋dm-verity等でのランタイム整合性保証」を要求する。
- 公開モデルを使う場合は、TinfoilのModelwrapでルートハッシュを自分で計算して照合してみる（github.com/tinfoilsh/modelwrap）。
- プライベート重みは自前でイメージ化し、ルートハッシュを含めたアテステーションを配布することで、顧客に同一性を示せる。さらに機密性が必要ならdm-cryptで鍵管理を検討する。
- 運用上の注意：初回ロードの遅延とビルド時間（大容量モデルでは数分〜十数分）を考慮したデプロイ設計を行う。

以上を踏まえ、日本企業がSaaS型推論を採用する際は「使われているモデルそのもの」を検証できる仕組みを要件に入れる価値があります。
