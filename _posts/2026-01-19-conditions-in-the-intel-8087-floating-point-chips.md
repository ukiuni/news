---
layout: post
title: "Conditions in the Intel 8087 floating-point chip's microcode - Intel 8087 浮動小数点チップのマイクロコードにある「条件」"
date: 2026-01-19T18:56:07.022Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://www.righto.com/2025/12/8087-microcode-conditions.html"
source_title: "Conditions in the Intel 8087 floating-point chip's microcode"
source_id: 46632120
excerpt: "8087のダイ写真で覗く分岐の裏側：49条件とMUX配置の工夫"
---

# Conditions in the Intel 8087 floating-point chip's microcode - Intel 8087 浮動小数点チップのマイクロコードにある「条件」  
思わず読みたくなる見出し：8087チップの“分岐の裏側”を覗く――古典FPユニットが使う49の条件とチップ設計の妙技

## 要約
1980年代の共演者・Intel 8087は、複雑な数学関数をマイクロコードで実装し、内部で最大64通り（実装は49種）の「条件」を使って分岐を制御していた。ダイ写真と回路解析から、その条件選択回路（マルチプレクサ群）や物理配置に基づく最適化が明らかになった。

## この記事を読むべき理由
- レトロPCだけでなく、マイクロコードやハードウェア分岐の設計原理を学べる。  
- 芯片の物理配置と論理設計が性能・配線にどう影響するか、日本の組込み／半導体エンジニアにも示唆を与える。

## 詳細解説
- マイクロコードとは：プログラマが見る命令（アセンブリ）より下位で動く、プロセッサ内部の小さな命令列。8087は1648個の16ビット・マイクロ命令で複雑な計算（三角関数、対数など）を実装している。  
- マイクロコードエンジン：内部で11ビットのマイクロアドレスを生成し、相対ジャンプ／サブルーチン／リターンを実行する“ミニCPU”。ジャンプはすべて条件付きで、条件に応じて分岐するかスキップする。  
- 条件の選択方法：マイクロ命令の6ビットで最大64条件を指定し、チップ上の各所に散らばった「条件信号」から一つを選ぶために、葉に近い場所に配置した小さなマルチプレクサ（MUX）を木構造で繋ぐ方式を採る。これにより長距離配線を削減する設計的工夫がされている。  
- 実装の工夫：理想図とは異なり、上位のMUXは4入力ではなく5入力を持つなど、物理的配置に合わせて各マルチプレクサの入力数を手作業で最適化している。  
- 回路素子と信号劣化：8087ではパストランジスタ（pass transistor）を多用するため信号は増幅されず劣化する。そこでツリー中にバッファ／インバータを挿入して信号を立て直す必要がある。  
- 条件の内容例：命令のビットチェック（15種類）、一時レジスタ tmpA/tmpB の状態、80ビットFP値に付く2ビットタグ（空／ゼロ／正規数／特殊値）による最適化、丸めモードと符号に基づく丸め判定、非正規化や精度喪失の例外判定など。さらに条件はビットPで反転可能（XORで実装）。  
- 具体例（FABS/FCHS）：符号反転（FCHS）と絶対値（FABS）はほぼ同じ処理で、下位 opcode ビットを条件にして同一ルーチン内で分岐させることで命令セットを効率化している。マイクロ命令のビット割り（例：ジャンプ種別・相対オフセット・条件番号・反転ビット）でその振る舞いが決まる。

## 実践ポイント
- マイクロアーキテクチャを学ぶ最短ルート：実機のダイ写真＋マイクロコード解析は「設計と実装の差」を直感的に教えてくれる。まずは右記ブログのダイ写真を拡大して回路パターンを見ると良い（Rightoの解析が教材に最適）。  
- FPGAで遊ぶ：8087風の小さなマイクロコードエンジンをFPGAで再実装して、MUXツリーや信号ブッファの配置・遅延を試すと学びが深い。  
- ソフト設計への応用：複雑な条件をソフト側でまとめると可読性が落ちるが、ハードでは「条件を分散配置して選択する」ことで配線負荷を下げられる、というトレードオフを意識する。特に組込み回路や低レイテンシ回路設計で有用な視点。  
- レトロ復元や教育に：日本のレトロPCコミュニティや大学の授業で、8087の事例は“物理設計が論理に与える影響”を示す良い教材になる。

（元記事の図や詳細なダイ写真、逆解析成果は原典を参照すると深掘りできます。）
