---
layout: post
title: "Show HN: A small programming language where everything is a value - すべてが値の小さなプログラミング言語"
date: 2026-01-26T00:17:17.814Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://github.com/Jcparkyn/herd"
source_title: "GitHub - Jcparkyn/herd: A simple interpreted programming language where everything is a value"
source_id: 46759520
excerpt: "Herdは全てが値のJIT言語で、コピーオンライトで安全に並列処理できる設計"
image: "https://opengraph.githubassets.com/10870228a7f198c12fe7e4c94b912177ed4a94b7af2f99eba6a69dec0ea0da77/Jcparkyn/herd"
---

# Show HN: A small programming language where everything is a value - すべてが値の小さなプログラミング言語
コピー不要で安全に並列処理できる言語──Herdが示す「全ては値」の設計

## 要約
Herdは「すべてが値」を貫く動的言語で、リストや辞書も含めて全てが値渡し（参照カウント＋コピーオンライト）されるため、関数呼び出しやスレッド間共有で副作用を心配せずに済む点が特徴です。

## この記事を読むべき理由
並列処理やバグの原因になりやすい共有ミュータビリティに悩む日本のエンジニアにとって、Herdの設計（値セマンティクス＋効率化の工夫）は安全性とパフォーマンスのバランスを考える良い実例になります。言語実装やインタプリタ学習素材としても最適です。

## 詳細解説
- 基本思想：全ての値はコピー可能な値。配列や辞書も値渡しで、デフォルトは不変（immutable）。ミュータブルにするには var 宣言、代入は set を使用。
- 参照管理：文字列・リスト・辞書など参照型は参照カウント。変更時は参照数が1ならインプレースで変更、複数参照があると浅いコピーを作って変更（コピーオンライト）。
- 結果として：参照サイクルが作れず、追加のサイクル検出なしに参照カウントがGC代わりになる。
- 言語機能：パターンマッチ、パイプ演算子（|）による関数チェーン、可変長引数、モジュールのimport/return、簡潔な無名関数構文など。例：Parallel.parallelMap / parallelRun による並列処理。
- 並列安全性：ミュータブル操作がスレッドごとのコピーに限定されるためデータレースが不可能。ただし「通信は戻り値経由」が基本。
- 実装上の工夫：単一パスJIT（cranelift）で実行時に機械語生成、NaN-boxingで数値などのプリミティブをヒープ無しで表現。これによりインタプリタとしては良好な性能を達成。
- 性能課題：原子参照カウントのオーバーヘッドや、インポート時のJITコンパイルによる起動コストがボトルネック。将来的には原子操作の持ち出し最適化等で改善可能。
- 設計トレードオフ：動的型、ユーザ定義型が未実装（将来的に構造体や多重ディスパッチを検討）、カリー化は意図的に排除してエラーメッセージの分かりやすさを優先。

## 実践ポイント
- まず試す：リポジトリをクローンしてREADMEのサンプルを実行。Parallel.parallelMapで並列挙動を確認するのが分かりやすい。
- 動作確認のコツ：var / set を使ってコピーオンライトの振る舞い（元の変数が変わらないこと）を試してみる。
- 学習用途：インタプリタ、参照カウント、NaN-boxing、cranelift連携の実装例として読むと学びが大きい。
- 実用検討：組み込みスクリプトや並列データ処理パイプラインのプロトタイプ言語として検討可能。ただし現状は趣味プロジェクトのため、本番採用には慎重を。
- 貢献案：日本語のドキュメント整備、サンプル追加（日本語データ処理例）、性能プロファイリングやatomic負荷軽減の提案が貢献しやすい入口です。
