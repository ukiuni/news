---
layout: post
title: "All your OpenCodes belong to us - あなたのOpenCodeはすべて私たちのもの"
date: 2026-01-19T04:32:14.954Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://johncodes.com/archive/2026/01-18-all-your-opencodes/"
source_title: "all your OpenCodes belong to us"
source_id: 46674424
excerpt: "ローカルAIエージェントOpenCodeの脆弱性でワンクリックRCEと機密流出が可能に"
image: "https://johncodes.com/og/2026/01-18-all-your-opencodes.png"
---

# All your OpenCodes belong to us - あなたのOpenCodeはすべて私たちのもの
OpenCodeが丸裸に──手元のAIエージェントがワンクリックで乗っ取られる現実

## 要約
人気のオープンソースAIコーディングエージェント「OpenCode（v1.1.10以前）」に、HTTPエンドポイント経由で任意のコマンド実行（RCE）とファイル読み取り、さらにはプロンプト注入を容易に許す重大な脆弱性がありました。エージェントがローカルで動く以上、被害は開発者のマシンやクラウド資格情報にまで及び得ます。

## この記事を読むべき理由
日本の開発現場でもローカルAIエージェントの導入が急速に進んでおり、同様の設計を採るツールは少なくありません。OpenCodeの事例は「エージェント＝便利な補助」ではなく「そのまま放置すると踏み台になり得る」ことを端的に示しており、今すぐ実務での防御策を講じる必要があります。

## 詳細解説
- RCE（Remote Code Execution）とは何が危険か  
  単なるバグ以上の意味を持ち、攻撃者が任意のコードを実行すればバックドア設置、秘密情報の窃取、クラウド資源の悪用などが可能になります。過去の複雑なバッファオーバーフロー脆弱性対応例と対照的に、OpenCodeの問題は「非常に単純かつ容易に悪用できた」点が特に深刻です。

- OpenCodeで起きていた脆弱点（要点）  
  古いOpenCodeは公開されたHTTP APIに、簡単に任意シェル実行を行えるエンドポイントを持っていました。代表的な攻撃面は次の通りです：
  - セッション内で任意シェルコマンドを実行するエンドポイント（POST /session/:id/shell）
  - 新しい擬似端末（PTY）を生成するエンドポイント（POST /pty）
  - 任意ファイルの内容を読み出すエンドポイント（GET /file/content）
  これらを組み合わせれば、攻撃者は開発者マシン上で任意のファイル読み書き・コマンド実行が可能になってしまいます。

- プロンプト注入の二次的リスク  
  実行したコマンドや読み出したファイルはそのままエージェントのコンテキスト（LLMの入力履歴）に入り得るため、プロンプト注入による追加の悪用（機密情報の漏洩や操作誘導）も現実的です。つまりRCEに加えて「エージェント自身を別の攻撃ベクトルとして使われる」危険があります。

- 再現と危険度（簡易イメージ）  
  脆弱なバージョンをチェックアウトしてローカルで起動すれば、セッションを作ってcurlでコマンドを投げるだけで任意のファイルを書けるほど単純でした（※実環境での試行は厳禁）。この容易さが被害を拡大させた主因です。

## 実践ポイント
- 今すぐやること
  - OpenCodeや類似エージェントは最新バージョンへアップデートする（脆弱性修正済みのバージョンを採用）。
  - エージェントのHTTPインターフェースをインターネット直結にしない。内部ネットワークやループバック以外からのアクセスを遮断。
  - 認証・認可を必須化し、未認可のリクエストを受け付けない設定にする。

- 運用上の防御
  - エージェントは権限を絞った専用ユーザーやコンテナで実行し、ホストのフルアクセスを与えない。
  - シークレット（SSH鍵、クラウド認証情報、ブラウザCookie）はエージェントから隔離し、必要最小限の権限で短期の条件付きクレデンシャルを使う。
  - ネットワークのアウトバウンド制御（Egressフィルタ）、プロセス監視、ファイル改変のアラート等を導入する。

- 監査と可観測性
  - エージェントの入力・出力・実行コマンドを監査ログに残し、追跡・再生できるようにする（「エージェント向けテレメトリ/フライトレコーダ」）。
  - SIEMやログ集約基盤と連携して、不審なセッションや未知のコマンド実行を自動検出するルールを作る。

- 組織的対策
  - 開発チームに「エージェントを信頼しすぎない」教育を行う。承認時は実行内容やスコープを慎重に確認する文化を作る。
  - 依存するオープンソース製品の脆弱性情報（CVE, GitHub Advisory）を追跡するプロセスを整備する。

OpenCodeの事例は単なる1件の脆弱性ではなく、AIエージェント運用そのものに関わる設計上の警鐘です。日本の開発現場でも、利便性と安全性のバランスをいま一度見直すタイミングです。
