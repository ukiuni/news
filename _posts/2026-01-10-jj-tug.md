---
layout: post
title: "jj tug - jj tug（ブックマークを最新に引っ張るエイリアス）"
date: 2026-01-10T21:13:31.518Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://shaddy.dev/notes/jj-tug/"
source_title: "jj tug | Shaddy's"
source_id: 703761501
excerpt: "jjのエイリアスtugで長いブランチ名をコピペせず最新ブックマークに一発移動"
image: "http://shaddy.dev/"
---

# jj tug - jj tug（ブックマークを最新に引っ張るエイリアス）
クリックせずにはいられない一行: jjで「ブランチ先を最新に自動で移動」する超便利エイリアスの紹介

## 要約
jjのエイリアス「tug」を使えば、手作業で長いブランチ名をコピペすることなく、直近の変更にブックマーク（jjの「ブランチ相当」）を自動で移動できます。

## この記事を読むべき理由
日本でもjj（Jujutsu）を試す開発者が増えています。gitと異なりjjはブックマークの先端が自動で追従しない設計なので、作業効率を上げる小ワザ—特に大量にブランチを作るワークフロー—を知っておくと日常的な操作が劇的に楽になります。

## 詳細解説
jjではブックマーク（bookmark）がブランチの役割を果たしますが、新しいコミットを作ってもブックマークは自動で移動しません。例えばログを見て最新の変更にブックマークを移したいとき、手で長い名前を指定して

```bash
# 長くて面倒な手動操作例
jj b move push-qlonwoskvtmu --to @-
```

のようにする必要があり面倒です。そこでコミュニティで紹介されているのが「tug」というエイリアスです。定義は次の通り：

```bash
tug = ["bookmark", "move", "--from", "heads(::@- & bookmarks())", "--to", "@-"]
```

（home-manager を使う場合の設定例）

```toml
programs.jujutsu.settings.aliases.tug = [
  "bookmark",
  "move",
  "--from",
  "heads(::@- & bookmarks())",
  "--to",
  "@-"
];
```

各要素の意味：
- @- : 親変更（parent change）を指す簡易参照。現在の作業点の一つ前。
- ::@- : @- の全ての祖先（ancestor）。親の祖先全体を参照します。
- bookmarks() : ブックマークの付いた変更のみを選ぶ。
- heads(...) : 与えた集合の中から「最新（最上位）」の変更を一つだけ選ぶ（複数ある場合に先端のみを取る）。

実例：
上流の祖先に bookmark2 と bookmark1 があった場合、このrevset（heads(::@- & bookmarks())）は「親の祖先のうちブックマークが付いている変更のうち最新のもの」を選び、それを現在の変更（@-）に移します。マージコミットの直後など特殊な履歴構造では移動対象が期待と異なる可能性があるので注意が必要です。

また、失敗しても jj undo で元に戻せるため試しやすい点も利点です。

## 実践ポイント
- まずはローカルでエイリアスを定義して試す（home-managerや~/.config/jujutsu/config.toml等に追加）。
- コマンド一発で最新ブックマークを移動できるため、短-lived な検証ブランチやCI用ブックマーク運用に便利。
- マージ直後の操作や複雑な歴史では対象ブックマークが意図しないものになる場合があるので、`jj log -r 'heads(::@- & bookmarks())'` で移動前に確認する習慣をつける。
- 問題が起きたら `jj undo` ですぐ戻せることを覚えておく。

小さなエイリアスが日常の手間を大幅に減らします。jjを使っているなら、まずはこの「tug」を入れて、revsetに慣れてみてください。
