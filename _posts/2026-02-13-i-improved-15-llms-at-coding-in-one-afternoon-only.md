---
layout: post
title: "I Improved 15 LLMs at Coding in One Afternoon. Only the Harness Changed. - ある午後に15のLLMのコーディングを改善した。変わったのはハーネスだけ"
date: 2026-02-13T07:31:26.901Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://blog.can.ac/2026/02/12/the-harness-problem/"
source_title: "I Improved 15 LLMs at Coding in One Afternoon. Only the Harness Changed. | Can.ac"
source_id: 995321231
excerpt: "編集ハーネスを変えるだけで15種LLMの修正成功率が大幅改善、モデル交換より効果的"
image: "https://blog.can.ac/2026/02/12/the-harness-problem/og.png"
---

# I Improved 15 LLMs at Coding in One Afternoon. Only the Harness Changed. - ある午後に15のLLMのコーディングを改善した。変わったのはハーネスだけ
編集フォーマットを変えただけでLLMの実用性が劇的に向上する理由 — ハーネス（編集インターフェース）に注目せよ

## 要約
モデルではなく「ハーネス（編集ツールの設計）」がボトルネックで、編集フォーマットを変えるだけで多くのLLMの修正成功率が大幅に上がる、という実証的な報告。

## この記事を読むべき理由
日本の開発現場でも「LLMが理解できない」「差分適用で壊れる」といった問題は頻出。モデルを替える前にハーネスを見直すだけで安定性とコスト効率が改善します。

## 詳細解説
- 問題の本質：多くの失敗は「モデルの理解力」ではなく、モデルとエディタ／ワークスペースをつなぐハーネスの設計ミスに由来する。モデルに依存したフォーマット（生のdiff文字列や完全一致の置換など）は、モデル間で再現性が低い。
- 既存手法の欠点：
  - apply_patch（OpenAI風の差分文字列）: 厳密フォーマットに依存するため、モデルがその表現を学習していないと失敗率が跳ね上がる。
  - str_replace（文字列置換）: 空白やインデントまで完全一致を要求し、多重一致や一致しないケースで失敗しやすい。
  - 専用マージモデル（Cursorのアプローチ）: 編集マージ専用の大規模モデルを使うが、追加モデルが必要でコストが増える。
- 提案した解法（Hashline）：ファイルの各行に短いコンテンツハッシュタグ（2–3文字）を付与し、編集命令はそのタグを参照して行う。これによりモデルは「どの行を編集するか」を文字列再生成に頼らずに指示でき、競合時はハッシュ不一致で安全に拒否できる。
- ベンチマーク概要：Reactリポジトリから生成したバグ風変異を修正するタスクで、16モデル・3編集ツールを比較。結果は一貫して「patch形式が最悪」「hashlineがreplaceを上回る／同等」で、弱いモデルほど恩恵が大きい。
- 具体的な改善例：あるモデルで成功率が6.7%→68.3%に跳ね上がった例や、出力トークンが61%減った例が報告されており、モデル切替より大きな実効改善を生んだケースもある。
- エコシステム的問題：オープンなハーネスを禁止・制限するベンダー運用（APIアクセス停止など）は、ハーネス最適化という重要な改善を妨げる。著者は「ハーネスは橋であり、閉ざすべきではない」と主張。

## 実践ポイント
- まずハーネスを疑う：モデルを替える前に編集フォーマットや編集の安全性（識別子・ハッシュ）を設計する。
- 行レベルの安定参照を導入：行ごとの短いコンテンツタグやIDを付けて編集命令に使うと衝突・誤編集を減らせる。
- フォーマットを複数試す：同じモデルでも編集フォーマットで成功率が大きく変わるので、A/Bベンチマークを必ず行う。
- トークン効率を監視：フォーマット改善でトークン消費が減ればコスト削減に直結する。
- オープンなハーネスを活用・貢献する：ベンダー固有の最適化だけに頼らず、複数モデルで動くハーネスをコミュニティで育てる価値が高い。
