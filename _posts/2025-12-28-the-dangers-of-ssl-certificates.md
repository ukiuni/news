---
layout: post
title: "The dangers of SSL certificates"
date: 2025-12-28T12:14:53.802Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://surfingcomplexity.blog/2025/12/27/the-dangers-of-ssl-certificates/"
source_title: "The dangers of SSL certificates"
source_id: 1147114848
excerpt: "BazelのSSL証明書期限切れ事故が示す、自動更新の落とし穴と現場で今すぐ使える対策"
---

# SSL証明書は「静かに止まる爆弾」――Bazel障害が教える期限切れリスクと現場対策

## 要約
GoogleのBazelで発生したレジストリ用SSL証明書の期限切れ障害は、証明書の「突然死」リスクと自動更新運用の落とし穴を端的に示す事例だ。自動化に依存するほど、障害時の対応経験がチームに蓄積されず、全ユーザーに一斉障害をもたらす。

## この記事を読むべき理由
証明書の失効は「よくあるけど見落とされがちな」運用リスクで、日本の企業でも年末年始や連休の隙を突く形で重大インシデントになり得る。依存先サービスやCI/CDが止まると事業への影響が大きく、今すぐ実務で使える対策が求められているからだ。

## 詳細解説
- 事例の概略  
  Bazelのレジストリ（bcr.bazel.build, releases.bazel.build）でSSL証明書が期限切れになり、ビルドや依存取得が全滅。クライアント側では Java の検証エラー（PKIX path validation failed / validity check failed）となり、依存フェッチが失敗した。

- なぜ「証明書」は厄介か  
  1) 時間ベースの障害：証明書の有効期限は「ある瞬間」に切れるため、徐々に悪化するようなシグナルが出ない。  
  2) 自動化の落とし穴：自動更新が「普段は成功する」ため、更新フローや権限周りに関する経験がチームに蓄積されない。休日に担当者不在だと復旧が難航する。  
  3) ブラスト半径の大きさ：失効は接続の全失敗を引き起こし、ユーザー全員に即時影響する。  
  4) 通知/運用フローの複雑性：発行者の通知に頼るだけでは不十分で、承認フローや配布先が多岐にわたると人的ミスが増える。

- 技術的留意点  
  - TLSハンドシェイクや証明書チェーン検証（PKIX）はクライアント側で厳格に行われるため、サーバが期限切れだと即リジェクトされる。  
  - ACME（Let’s Encrypt等）自動更新は有効だが、DNSやサブドメイン構成の変更で失敗することがある。失敗ログ・通知を確実に運用に流す仕組みが必須。  
  - OCSP/OCSP staplingやCertificate Transparencyは可用性や検出性の向上に寄与するが、失効「予防」には直接ならない。

## 実践ポイント
- まずは全証明書のインベントリ化：サーバ、ロードバランサ、CDN、IoT機器、外部ベンダのものまで洗い出す。  
- 監視と多段階アラート：有効期限の90/30/7/1日でアラート。メールだけでなくSlack/チャットOps/Webhookで複数経路通知。  
- 自動更新のテスト運用：本番とは別に定期的な更新リハーサル（テスト証明書でのロールオーバー）を実施。  
- ロールフォールと冗長化：可能なら代替ドメインやCDNの証明書管理を使い、依存先の単一障害点を減らす。  
- 明確な権限とRunbook：誰がどの手順で更新するか、権限の委譲、休日時の連絡先を文書化して訓練する。  
- ログと監査：ACMEクライアントや発行APIの失敗ログを長期間保持し、アラートと結びつける。  
- サプライチェーンの可視化：外部パッケージ/レジストリを使う場合、相手側の証明書管理リスクを契約・SLAや監視で補う。

