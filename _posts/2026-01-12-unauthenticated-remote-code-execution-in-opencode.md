---
layout: post
title: "Unauthenticated remote code execution in OpenCode - OpenCode における認証なしリモートコード実行脆弱性"
date: 2026-01-12T19:34:27.728Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://cy.md/opencode-rce/"
source_title: "Unauthenticated remote code execution in OpenCode"
source_id: 46581095
excerpt: "あなたの開発機が勝手に公開され認証なしで任意実行されるOpenCode脆弱性"
---

# Unauthenticated remote code execution in OpenCode - OpenCode における認証なしリモートコード実行脆弱性
あなたの開発マシンが“知らないうちに公開”されているかも？OpenCodeの自動起動HTTPサーバが招く即時リスク

## 要約
OpenCode（npm: opencode-ai）は過去のバージョンで起動時に認証なしのHTTPサーバを立ち上げ、ローカルや一部のウェブ経由で任意のコマンド実行やファイル読み出しが可能でした。現在はサーバがデフォルトで無効化されるなどの対処が入っていますが、サーバを有効化すると未だに認証が存在しない点が残っています。

## この記事を読むべき理由
- 多くの日本の開発者はNode.jsベースのツールやnpmパッケージ、VSCodeなどローカル開発環境を使っています。本脆弱性は「開発マシンそのもの」が攻撃対象になり得るため、即時の確認・対策が必要です。  
- 企業のノートPCや社内ネットワークにあるマシンが被害を受けると、ソースコードや資格情報の流出、ビルド環境の汚染といった深刻な二次被害が起きます。

## 詳細解説
- 何が起きたか：OpenCodeは旧バージョンで起動時にHTTPサーバ（デフォルトポート4096以降）を自動で立ち上げていました。このサーバは認証を要求せず、以下のような機能を公開していました（要点のみ）：
  - シェルコマンド実行用のエンドポイント
  - 対話型端末（PTY）作成用のエンドポイント
  - 任意ファイルの読み出し用エンドポイント
- 主要な変更：
  - v1.0.216：CORSの制限が導入され、デフォルトで *.opencode.ai からのアクセスが許可される設定が追加（制限強化の一部）。
  - v1.1.10：起動時にサーバをデフォルトで無効化するようになった。
- 依然として残る問題点：
  - サーバを手動で有効にすると、認証が存在しないまま動作するため、ローカルの他プロセス・ローカルネットワーク・一部のウェブ経由で悪用され得る。
  - opencode.ai やそのサブドメインが信頼されたオリジンとして扱われており、万が一そのホスト群に脆弱性や乗っ取りがあれば被害が拡大するリスクがある。
  - --mdns 等のフラグで外部公開されるとネットワーク上の他端末からもアクセス可能になる（ドキュメントでの説明不足）。
- 開発者向けの注意：この種のツールがデフォルトでネットワークAPIを公開する場合、必ず認証・TLS・明確なユーザー表示が必要です。自動化された「サイレントでの公開」は致命的なリスクを生みます。

## 実践ポイント
すぐに取れる安全措置（重要）
- バージョン確認と更新（安全な最小版へ）
```bash
# バージョン確認
opencode --version
# 可能なら最新の安全版へ更新
npm install -g opencode-ai@latest
```
- サーバの設定確認：設定ファイルに server.port / server.hostname 等があれば無効化するか削除する。意図しない起動を避ける。
- mdnsフラグを使わない：--mdns は意図せず0.0.0.0バインドになる可能性があるため使用禁止に。
- ネットワーク露出の確認：ローカルで該当ポートがListenしていないか確認する。
```bash
# 代表的な確認例（環境に合わせて選択）
ss -ltnp | grep 4096
# または
netstat -ltnp | grep 4096
```
- 最小権限・分離：開発ツールは専用のコンテナや限定ユーザーで実行し、重要ファイルや資格情報は開発環境から分離する。
- ブラウザ操作の注意：サーバを有効にしている間は opencode.ai やそのサブドメイン、見慣れないローカルホストのページを開かない。
- 組織での対策：管理者は社内の開発環境で該当ポートをファイアウォールでブロックし、ツールのバージョン管理・配布ポリシーを設定する。

開発者・ベンダーへの推奨（要望）
- サーバ機能に認証とTLSを必須化する。  
- サーバが起動していることを明示するUIや起動メッセージの表示を追加する。  
- --mdns の振る舞いをドキュメントで明確にし、デフォルトでローカル限定にする。  
- 公式セキュリティアドバイザリ公開とCVE取得、通知チャネルの監視強化。

—  
短時間で確認すべきは「自分の環境でOpenCodeが動いていないか」「サーバ設定が有効になっていないか」「最新版へ更新できるか」の3点です。安全が確認できるまでは該当ソフトの使用を控えることを推奨します。
