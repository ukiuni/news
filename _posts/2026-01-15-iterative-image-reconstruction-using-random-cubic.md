---
layout: post
title: "iterative image reconstruction using random cubic bézier strokes - ランダム3次ベジェ曲線による反復的画像再構築"
date: 2026-01-15T19:19:53.055Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://tangled.org/luthenwald.tngl.sh/splined"
source_title: "iterative image reconstruction using random cubic bézier strokes"
source_id: 764485233
excerpt: "Metalで3次ベジェを大量試行し誤差低減のみで名画を芸術的に再現する手法"
---

# iterative image reconstruction using random cubic bézier strokes - ランダム3次ベジェ曲線による反復的画像再構築
たった「ベジェ曲線の集合」で名画をなぞる──ランダムな3次ベジェストロークを使って画像を再構築する、Metalで高速化された手法の紹介

## 要約
ランダムに生成した3次ベジェ曲線（4点制御点）を大量に試し、「目に見える誤差（Oklabの二乗誤差）」を減らすストロークだけを採用してキャンバスを更新する反復的再構成手法。AppleのMetalで高速化され、同じ入力でもシードでまったく違う表現が得られる。

## この記事を読むべき理由
- 画像処理・生成の新しいアプローチとして、ピクセル直接操作でもなく完全なニューラル生成でもない“ストローク単位の再構成”はクリエイティブツールとして魅力的。
- Mac/iPhoneなどMetalを利用できる環境が多い日本の開発者にも手を動かして試せる点で実用的。
- 美術館のオープンデータ（例：The Met）と組み合わせれば、生成物の素材入手が簡単で二次創作や可視化の実験に向く。

## 詳細解説
- 色空間：評価には知覚的に均一な Oklab を使用。これにより「人間が感じる違い」に近い指標で誤差を判定する。  
  - 受け入れ条件は $\Delta \varepsilon^2 < 0$（Oklabでの二乗誤差が減る場合のみ採用）。
- 初期化：キャンバスは入力画像の平均色（または指定の背景色）で開始する。
- ストローク生成：
  - ランダムにサンプリングした3次ベジェ（制御点4つを画像領域内で一様に）をバッチで生成。
  - 各ベジェをラスタライズしてカバレッジマスクを得る。
  - マスクで重み付けしたターゲット画素の平均色をそのストローク色に設定。
- 採否と更新：
  - ストロークが二乗誤差を減らす場合のみ「受理」してキャンバスにコミット。
  - これを目標のストローク数に達するまで（あるいは収束）繰り返す。
- 実装とチューニング：
  - MetalでGPU並列化して大量の候補ストロークを高速に評価する点が肝。将来的には他のバックエンド（wasm等）対応が検討中。
  - デフォルトの最大ストローク数は画像サイズに依存して $(w*h)^{0.7}$ に設定されている。
  - バッチサイズ、シード、ストローク透過度（alpha）や出力間隔（--nth）などで表現や速度を調整できる。

関連プロジェクトとして、Geometrize（幾何図形で画像を近似するツール）があり、手法的には近い発想だが本手法は「ベジェ曲線＋Metal」で動的な筆致を作る点が特徴。

## 実践ポイント
- 動かし方（Macでの基本）:
```bash
bash
cargo build -r
```
```bash
bash
# 単発出力
splined in.png -n 5000 -b 64 -s 42 -o out.png

# フレームを保存してアニメーションを作る
splined in.png --nth 50 -o frames/
```
- パラメータの勧め：
  - まずは -b 32〜64、-n 2000〜5000 で挙動を確認。顔写真など細部重視なら n を増やす。
  - 再現性を重視するなら -s <seed> を固定。芸術的なバリエーションが欲しければシードを変えて複数生成。
  - 透過度 -a を 0.8〜1.0 にして重ね塗りを調整。
  - 長時間実行する場合は --max-gpu で利用率を制限。
- 応用案：
  - The Metなどのオープンアクセス画像を素材にして、生成過程のタイムラプス（--nth）を作れば作品風アニメを簡単に作成可能。
  - GeometrizeやSVG出力と組み合わせて、ストロークをベクトルで保存・編集するワークフローを作ると面白い。

短くまとめると、「ランダムなベジェを大量に試して良いものだけ採用する」というシンプルなルールと、Metalによる並列化の組合せがこの手法の強み。実験コストが低くクリエイティブな出力が得やすいので、画像表現や生成アートの入門的な実験に最適。
