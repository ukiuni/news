---
layout: post
title: "Windows? Linux? Browser? Same Executable - Windows？Linux？ブラウザ？同じ実行ファイル"
date: 2026-01-15T20:20:44.874Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://hackaday.com/2026/01/15/windows-linux-browser-same-executable/"
source_title: "Windows? Linux? Browser? Same Executable | Hackaday"
source_id: 426119685
excerpt: "13KBの単一ファイルでWindows・Linux・ブラウザ全てで動くスネークの作り方デモ"
image: "https://hackaday.com/wp-content/uploads/2026/01/snake.png"
---

# Windows? Linux? Browser? Same Executable - Windows？Linux？ブラウザ？同じ実行ファイル
1ファイルでWindowsもLinuxもブラウザも動かす――13KBの「マルチプラットフォーム」スネーク

## 要約
13KBの単一ファイルで、WindowsのPE実行形式、Linuxのシェルスクリプト/ELF、さらにはブラウザで表示できるHTMLの3種を切り替えて動かすデモが公開された。中身はシンプルなスネークだが、ファイルフォーマットを巧みに突いた興味深いテクニックだ。

## この記事を読むべき理由
OSやブラウザのファイル処理の違いを知れば、小さな実験からセキュリティや配布のアイデアまで広がる。特にクロスプラットフォーム配布、バイナリ構造の学習、CTFや教育用途で役立つ実例だから、日本のエンジニア／学生にも学びが多い。

## 詳細解説
- アイデアの本質  
  各実行環境（Windows、Linux、ブラウザ）はファイルを読むときに「最初に期待するシグネチャ」が異なる。作者はこれを逆手に取り、ファイル先頭を工夫して各環境が自分用の部分だけを解釈するようにしている。

- どうやって動くか（ポイント）  
  - Windows向けにはPEヘッダ（MZ/PE）を先頭に置く必要がある。  
  - しかしそのPEヘッダは柔軟で、先頭の一部を有効なシェルスクリプト（Linux側）に見せるように作れる。結果として、Linuxでは先頭の“ゴミ”をスキップしてシェルスクリプトを実行できる。  
  - ブラウザはファイル中の最初の`<HTML>`タグまでの全てを無視する実装が多いため、そこにHTMLを置けばブラウザ表示も可能。  
  - 実際の実装では3つのプラットフォーム向けコードをそれぞれ圧縮して結合しており、各環境が自分用のデータを取り出して解凍・実行する構造になっている。

- 制約と現実性  
  - 各プラットフォーム間でコード共有はほとんどなく、単にバイナリを縫い合わせているに過ぎないため実務的な効率は低い。  
  - 一部のアンチウイルスやブラウザが不正なヘッダを検出してブロックする可能性がある（実際にダウンロードがウイルス扱いされた例あり）。  
  - 実用配布には署名やOSごとの最適化、ライセンス、セキュリティ対策が必要。

- 背景技術への言及  
  - Cosmopolitan（APE形式など）は、1つの実行ファイルで複数OSを狙うアプローチの既存プロジェクト。今回の例は「薄く・小さく」まとめたデモとして興味深い派生と言える。

## 実践ポイント
- ファイルの中身を覗く基本コマンド（学習用）:
  ```bash
  file target.bin
  xxd -l 256 target.bin | head
  ```
- 学びたい人向けの実験手順:
  - 小さなテキスト/HTML部分と簡単なシェルスクリプトをつなげ、ブラウザで表示とLinuxで実行できる“ポリグロット”を作ってみる。  
  - PEヘッダやMZスタブの構造を調べ、なぜWindowsが先頭をスキップするのか理解する（仮想環境で試すこと）。  
  - CosmopolitanやAPEに触れて、より実用的なクロス実行技術と比較する。

- 注意点（必須）:
  - この種の技術は悪用されるリスクがある（マルウェア配布の可能性）。実験は必ず自分の環境か隔離されたVMで行い、配布は避ける。  
  - 実運用で使うべきではなく、教育・研究・CTFの練習材料として取り扱うこと。

短いデモながら、ファイルフォーマットと各プラットフォームの振る舞いを直感的に学べる良い教材です。興味があれば、まずはヘッダ解析と小さなポリグロットを作るところから試してみてください。
