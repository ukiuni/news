---
layout: post
title: "I built a tool that lets one image \"steal\" the color soul of another - ある画像の“色の魂”を別画像に盗ませるツールを作った"
date: 2026-01-11T16:27:18.364Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://github.com/SosoTaE/turn_into"
source_title: "GitHub - SosoTaE/turn_into"
source_id: 430714150
excerpt: "Rust製ツールで一枚の画像の色の“魂”を頻度ベースで別画像に丸ごと移植し劇的に雰囲気を変える"
image: "https://opengraph.githubassets.com/d3cb1be6bacdf68843b3585b13a1310374e6dc8f1e7cb8cc1f92b56db8f06f5b/SosoTaE/turn_into"
---

# I built a tool that lets one image "steal" the color soul of another - ある画像の“色の魂”を別画像に盗ませるツールを作った
色の「魂」を写し取る新発想：Rust製の高速カラー変換ツールで写真の雰囲気を丸ごと差し替える

## 要約
一枚の画像の「色の分布（＝美的な魂）」を別の画像に移すRust製CLIツール。色空間はCIE $L^*a^*b^*$ を使い、頻度（出現率）に基づくマッピングで大胆なスタイル変換を実現する。

## この記事を読むべき理由
- 単なる色近傍マッチではなく「頻度ベース」で色を入れ替える発想は、写真や広告、ゲーム素材などで意図的に雰囲気を変えたい場面で有効。  
- Rust＋Rayonによる並列高速処理設計は、ローカルで大量画像処理を行う日本の開発者／デザイナーにも実用的。

## 詳細解説
- 基本手順  
  1. 両画像からサムネイルを作り、K-Meansで色クラスタ（パレット）を抽出。  
  2. 各クラスタの「重み（ピクセル数）」でソートし、上位から順にインデックス対応させる（頻度ベースのマッピング）。  
  3. フル解像度のピクセルを並列に置換して結果を生成。  
  これにより「空が紫で多かった画像A」が「緑が多い画像B」の雰囲気を引き継ぐ、という劇的な変化が可能になる。

- 色空間と知覚的一致性  
  ツールは CIE $L^*a^*b^*$ を採用し、人間の視覚に基づく距離評価で量子化を行う。距離計算はコストを下げるために平方距離を使用し、ホットループでの sqrt を避けている。具体的には次のような距離評価を内部で使う：
  $$
  \Delta E^2 = (L_1-L_2)^2 + (a_1-a_2)^2 + (b_1-b_2)^2
  $$

- パフォーマンス最適化  
  - Rayon によるCPU全コア活用（par_bridge() 等で行単位に分配）。  
  - サムネイルでのK-Meansによりメモリと時間を節約。  
  - ホットループ最適化でリアルタイム感に近い速度を実現（モダンなCPUで良く効く）。

- 将来の拡張案（作者メモ）  
  - GPU（wgpu）経由の高速化、Kの自動推定（Elbow法自動化）、WASMでブラウザ対応などを検討中。

## 実践ポイント
- 試す手順（Rust環境が必要）:
```bash
# ビルド（最適化フラグ付き）
cargo build --release

# 実行例
./target/release/turn_into ./images/A.jpg ./images/B.jpg ./images/result.png
```

- K（クラスタ数）は画像や狙い次第で調整。まずは16〜64あたりで試して、結果のディテール／大局感を比較すると良い。  
- 日本市場での活用例：ECの商品写真でブランドカラーに統一、広告ビジュアルの一括トーン変換、ゲームやアプリのアセットのローカライズ（地域別の色調に合わせる）など。  
- 大量処理やインタラクティブな応用を目指すなら、GPUパスやWASM展開の動向に注目すると投資対効果が高い。

以上。リポジトリは MIT ライセンスで公開されており、ソースを読んでローカルで試せる。興味があれば、まずは手持ちの写真で「色の魂」を差し替えて違いを体感してみることをおすすめする。
