---
layout: post
title: "Obvious Things C Should Do - Cが当然やるべきこと"
date: 2026-01-24T08:22:40.757Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://www.digitalmars.com/articles/Cobvious.html"
source_title: "Obvious Things C Should Do - Digital Mars"
source_id: 418958560
excerpt: "CTFEやコンパイル時テスト、ヘッダ不要化でC開発の生産性を劇的に改善する提案"
---

# Obvious Things C Should Do - Cが当然やるべきこと
もう待てない！C言語に今すぐ導入してほしい“当たり前”の改善点

## 要約
元記事は、C言語（C23を含む）が未だ放置している「当たり前にできそうな改善点」―コンパイル時関数評価（CTFE）、コンパイル時ユニットテスト、前方参照の柔軟化、ヘッダ不要の宣言インポート等―を指摘し、D言語側のImportCでの実装例を通じて実現可能性を示しています。

## この記事を読むべき理由
日本の組込み／レガシー中心の現場でも「テストしにくい」「ヘッダ地獄」「ビルドが面倒」といった生産性の低さは共通課題です。これらの改善はバグ削減や開発コスト低下に直結します。

## 詳細解説
- コンパイル時関数評価（CTFE）
  - 現行Cでは列挙定数や`_Static_assert`に渡せる式が限定的で、関数をコンパイル時に実行できません。ImportCは副作用のない関数をコンパイル時に評価でき、定数式の表現力と安全性が飛躍的に向上します。
  - 例：
    ```c
    // c
    int sum(int a, int b) { return a + b; }
    _Static_assert(sum(3,4) == 7, "test #1");
    ```
- コンパイル時ユニットテスト
  - CTFEがあれば、ビルド時に関数の単体テストを実行して失敗を即検出できるため、別ターゲットや実行環境を用意せずにテストを常態化できます。
- 前方参照（宣言の順序依存）の撤廃
  - 現在のCは定義順に依存して暗黙宣言問題が起きやすい。モダンなコンパイラは任意の順序のグローバル宣言を受け入れ、ヘッダでの冗長なプロトタイプ作成を不要にします。
- 宣言のインポート（ヘッダ不要化）
  - ソース単位を直接インポートする設計により、ヘッダファイルの手作業での同期ミスや過剰なメンテを減らせます。ImportCの`__import`的アプローチが一例です。

## 実践ポイント
- まずは小さな関数でCTFE相当を意識して設計し、可能ならコンパイラの`_Static_assert`でチェックを増やす。
- ビルドシステムにユニットテスト用ターゲットがないなら、静的アサーションやコンパイル時評価を活用して早期検出を狙う。
- ヘッダ管理が煩雑なら、ヘッダ自動生成ツールやモジュール化（利用可能なツール/コンパイラの機能）を検討する。
- 新規プロジェクトや実験的導入では、ImportCのようなモダンなツールや言語（あるいはClangの拡張機能）でプロトタイプを試し、利便性とリスクを評価する。
