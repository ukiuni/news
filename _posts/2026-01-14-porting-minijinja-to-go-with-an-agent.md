---
layout: post
title: "Porting MiniJinja to Go With an Agent - MiniJinja を Go に移植してみた（エージェント活用編）"
date: 2026-01-14T17:18:13.463Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://lucumr.pocoo.org/2026/1/14/minijinja-go-port/"
source_title: "Porting MiniJinja to Go With an Agent | Armin Ronacher's Thoughts and Writings"
source_id: 1345846908
excerpt: "エージェントとスナップショットでRust製MiniJinjaを短時間でGoへ移植した実例"
image: "https://lucumr.pocoo.org/social/2026-01-14-minijinja-go-port-social.png"
---

# Porting MiniJinja to Go With an Agent - MiniJinja を Go に移植してみた（エージェント活用編）
エージェントに丸投げで45分の指示から10時間の作業を回して、Rust 実装のテンプレートエンジンをGoへ移植した話

## 要約
Armin Ronacher が MiniJinja（Rust の Jinja2 再実装）を、テスト駆動でエージェントに部分的に任せて Go に移植した実験の記録。既存のスナップショットテストを利用した逐次的な移植、エージェントの分岐管理、振る舞いベースの実装選択と最終的な調整手順が中心。

## この記事を読むべき理由
- ライブラリ移植やクロスランゲージ対応を考える日本の開発者にとって、「エージェント＋テスト駆動」で短時間に実用的な移植が可能になった現実を示す実例だから。
- テスト設計やCI整備の重要性、そして人の役割（設計ガイド、妥当性チェック）がどう変わるかが具体的に学べるから。

## 詳細解説
- 背景：MiniJinja は Rust で書かれた Jinja2風テンプレートエンジン。移植の検証には Rust 側の snapshot テスト（insta）が使われた。スナップショットは入力→期待出力のペアで、出力の差分で変化を検出できる。
- テスト駆動での進め方：エージェントに「既存の snapshot を再利用して、段階的に移植（lexer → parser → runtime）して全部通す」ことを目標に設定。エージェントはテストパーサや比較ツール、失敗テストの一時除外リストを自動生成し、フィードバックループが短い状態で動いた。
- エージェント運用の工夫：Pi の「ブランチ」機能で作業フェーズを分け、途中の状態へ戻して再利用できるようにした。ブランチ切り替え時に要約を入れてくれるため、エージェントが既存の進捗を再探索する手間を減らせた。
- 実装上の分岐：エージェントは「字句・構文は同じ振る舞いを保つが、内部実装は言語慣習に合わせる」方向に進めた。例：Rust のバイトコード式実装を忠実に再現せず、Go ではツリー歩きのインタプリタ＋reflect を利用する選択を自律的に行った。これは GC や型情報の有無といったランタイム差を踏まえた賢い判断。
- 人の介入が必要だった点：エージェントは「must-fail（明示的に失敗すべき）テスト」のエラーメッセージを再現しきれなかったため、著者はあいまい一致（fuzzy matching）を導入するよう指示。さらにHTMLエスケープの厳密動作や range の挙動など、保持したい仕様は手動で誘導した。
- 最終工程：欠けているフィルタやマクロの補完、ドキュメント化、リファクタリング、CI/リリース設定はエージェントに任せつつ最終確認を行いマージへ。夜間にモデルを変えて自動的に作業を続けさせた例も紹介される。

## 実践ポイント
- テストが資産：移植の成功率は「良いテストスイート」に依存する。snapshot テストや入力→期待出力の明確化は移植コストを大幅に下げる。
- エージェントには明確な目標と段階を与える：大目標（全部通す）に加え、段階（lexer→parser→runtime）を示すと進捗が安定する。
- 差分許容設計を用意する：ランタイム差から来るエラーメッセージや微妙な挙動は完全再現が難しいので、fuzzy matching やスキップリストで段階的に解決する。
- 人の役割は「設計ガイド」「仕様の保持」「最終確認」：エージェントは実装作業を可視化・自動化するが、仕様維持や重要な設計判断は人が行うべき。
- 日本の現場での応用例：社内ツールを別言語で展開したい、組み込み向けに軽量化したい、といったケースでプロトタイプ移植→CI 連携→レビューの流れは即応用可能。特に既にテストが整備された OSS を取り込む場合は、テスト駆動で安全に移植できる。
- コスト見積もりの目安：著者の例では人の能動時間は約45分、エージェント実行は数時間〜十時間、APIコスト有り。小規模ライブラリなら短時間で実用的なポートが期待できる。

この記事は「エージェントをツールとして使い、テストを中心に据えることで移植の敷居が下がった」ことを示す実践的なケーススタディだ。移植やマルチ言語展開を検討しているチームは、まずテストの整備と小さなコンポーネントでのエージェント試験運用から始めると良い。
