---
layout: post
title: "Audio on hp300 - hp300でのオーディオ"
date: 2026-02-02T02:05:41.198Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "http://miod.online.fr/software/openbsd/stories/arcofi.html"
source_title: "Audio on hp300"
source_id: 900762037
excerpt: "OpenBSDがhp300の眠るオーディオをHP‑UXヘッダと既存ドライバで復活"
---

# Audio on hp300 - hp300でのオーディオ
レトロHPワークステーションに音を取り戻す──OpenBSDが辿った7ビット／16ビットの謎解き

## 要約
1980〜90年代のワークステーション、特にHP 9000/425e（hp300系）に眠るオーディオ機能を、OpenBSDコントリビュータがハード寄せ集めとソース解析で復活させた話。HP‑UXのヘッダ解析と既存ドライバ（harmony）の比較が突破口になった。

## この記事を読むべき理由
レトロハードのドライバ移植や低レイヤーの逆解析は、組み込み／OS開発の基礎力を鍛える最短ルート。日本でもレトロコンピューティングや省電力ビルドマシン用途で役立つ知見が得られます。

## 詳細解説
- 背景：1980年代末からワークステーションに音声入出力が追加され、NeXTなどが先陣。HPの9000シリーズにもphone〜CD品質の機材が混在する。
- 対象機：HP 9000/425e（68040 25MHz）──hp300世代の例外的にオーディオ端子を持つ68000系機。ROMはHP‑UX／Domain/OSのデュアルモード、拡張バスはDIO（16bit）。
- 問題：OpenBSDのブートログは「digital audio ... not configured」と表示。物理的には入出力ジャックあり。誰もオーディオを有効化していなかった。
- アプローチ：作者はHP‑UXの/usr/include/sys/audio.hを参照。そこで定義されたaudio1_reg/audio2_regのレジスタレイアウトが、PA‑RISC側のharmonyドライバ（CS4215系）で使われるレジスタマップと一致することを発見。
- キー観察：
  - series300（hp300/DIO）はレジスタが16bitワードの「第2バイト」に配置されるのに対し、series700（PA‑RISC）は32bitワードの第2バイトに置かれる。つまり同一設計でバス幅だけ違う。
  - AUDIO_ID_PSB2160 や AUDIO_ID_CS4215 といった定義があり、CS4215は既存のharmonyドライバで扱われていることを確認。
- 結果：既存ドライバやHP‑UXヘッダを手掛かりにして、hp300向けの接続／設定コードを書けばオーディオが動く見通しが立った。類似の取り組みとしてVAXでのAMD7930ドライバ移植と、mpg123での低サンプル再生（例：--8bit -m -r 8000）で動作確認が行われた。

## 実践ポイント
- レトロ機器の音を鳴らしたければ：
  1. HP‑UXや他OSのヘッダ（audio.h）を参照し、レジスタ定義を探す。キーワード：audio1_reg/audio2_reg、AUDIO_ID_*。
  2. カーネルソース（OpenBSD/NetBSDのharmonyなど）と比較して、レジスタオフセットとバス幅（16/32bit）を確認する。
  3. 必要ならSGC/DIOバスやフレームバッファ周りのサポートを先に追加する。
  4. ユーザ空間での検証には mpg123 を使い、古いハードの能力に合わせてオプション（例: --8bit -m -r 8000）を指定する。
- 注意点：古いハードは発熱や半田接点の劣化があるため、CPU交換や電源保守に注意すること。

（レトロハードの逆解析は学びも大きく、日本の趣味／研究コミュニティでも活用しやすい題材です。）
