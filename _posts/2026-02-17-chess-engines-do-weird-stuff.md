---
layout: post
title: "Chess engines do weird stuff - チェスエンジンは変なことをする"
date: 2026-02-17T17:47:30.887Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://girl.surgery/chess"
source_title: "Chess Engines Do Weird Stuff"
source_id: 47049845
excerpt: "検索蒸留やSPSAで自己対戦不要にする実践的棋譜最適化術で低コストに強化"
---

# Chess engines do weird stuff - チェスエンジンは変なことをする
チェスAIの裏ワザ：検索×蒸留で生まれる“不思議な”強さ

## 要約
チェス界では、自己対戦で学ぶ強化学習（RL）よりも、検索（search）で得た評価をモデルに「蒸留」する手法が効率的で強力になっている。さらに、ランタイムでの蒸留やSPSAによる勝率直接最適化など、実戦向けのトリックが多数使われている。

## この記事を読むべき理由
自己対戦は高コストで時間がかかるため、日本のAI開発者やチェス／将棋エンジン開発者にとって、より少ない計算で強さを引き出す手法はすぐに応用可能でコスト削減につながるからです。

## 詳細解説
- RLと蒸留の立場  
  AlphaZero以降の流れでは自己対戦RLが主流だったが、実態は「モデル差は約 $200\ \mathrm{ELO}$、検索の効果は約 $1200\ \mathrm{ELO}$」と大きく、検索を組み合わせた弱いモデルから良いモデルへ蒸留すれば自己対戦を大量に生成する必要がない。lc0チームはBT4を蒸留で作り、逆にRLループで悪化する事例を観測している。

- なぜ検索蒸留が効くか  
  検索（複数手先の評価）を使った評価は、その場でモデルより遥かに正確な「師匠」になる。チェスではモデルを50局面検索する効果が大きく、実質的にモデルサイズを $30\times$ に相当するほど補強するが、LLMのbest-of-$n$はせいぜい $2\times$ 程度の利得にとどまる。

- ランタイム蒸留（オンライン調整）  
  実局面でNN評価と検索評価を比較し、差分をネットワークの評価に反映していく。例えばネットワークが +0.15 と出す局面で検索が異なるなら、その差を将来の評価から引くことでネットワークがその対局に“順応”する。

- 勝つことを直接最適化する（SPSA）  
  SPSAは勾配を使わず、重みをランダムに±方向へ動かした2ネットワークを対戦させ、勝つ方向に学習率で移す手法。小さなモデルで $+50\ \mathrm{ELO}$ 程度の改善が報告されるが、何千局もの対局を要するため非常にコストが高い。

- C++実装のパラメータチューニングにも応用可能  
  SPSAはニューラルネット重みに限らず、探索アルゴリズム中の任意の実数パラメータを連続値化して勝率でチューニングできる。手作りヒューリスティックを微小値で調整して実戦で評価することで小さな改善（例：$+5\ \mathrm{ELO}$）が積み上がる。

- アーキテクチャと注意バイアス（smolgen）  
  lc0は畳み込みからトランスフォーマへ移行し数百ELOの改善を得た。さらに「smolgen」と呼ぶ注意バイアス生成の仕組みでスループットは $1.2\times$ に落ちるが、精度はモデルサイズ換算で約 $2.5\times$ 相当の利得があるとされる。

## 実践ポイント
- エンジン開発でのコスト削減：まずは検索蒸留を試すと自己対戦コストを大幅削減できる。  
- ランタイム適応：対局アプリやオンライン対戦サービスではランタイム蒸留で局面適応を実装できる（まずは評価差のオフセット追加から）。  
- SPSAで黒箱パラメータ最適化：複雑な手作りヒューリスティックやC++パラメータを勝率で調整する実験を検討する。  
- アーキテクチャ選定：小規模でもトランスフォーマ＋注意バイアスは効果的。計算コストと精度のトレードオフを評価する。  
- 日本市場向け応用：将棋エンジンやAI搭載ボードゲームにも応用可能。クラウドコストを抑えたいスタートアップや研究室に特に有用。

元記事はチェス界の実践知を通じて「勝ちに直結する学習・チューニング」の具体例を示しています。まずは小さな蒸留実験から始めるのがおすすめです。
