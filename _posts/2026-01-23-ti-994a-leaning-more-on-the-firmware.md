---
layout: post
title: "TI-99/4A: Leaning More on the Firmware - TI-99/4A：ファームウェアにより深く依存する"
date: 2026-01-23T06:27:26.985Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://bumbershootsoft.wordpress.com/2026/01/17/ti-99-4a-leaning-more-heavily-on-the-firmware/"
source_title: "TI-99/4A: Leaning More Heavily on the Firmware | Bumbershoot Software"
source_id: 46673216
excerpt: "ファーム活用でTI-99/4Aの音とスプライトが飛躍的に向上する実践解説"
image: "https://bumbershootsoft.wordpress.com/wp-content/uploads/2025/02/ti99_06_fancy_banner.png"
---

# TI-99/4A: Leaning More on the Firmware - TI-99/4A：ファームウェアにより深く依存する
TI-99/4Aをファームウェア中心で操ると、古いホームコンピュータの音とスプライトが驚くほど洗練される

## 要約
TI-99/4AのGROM（Graphics ROM）やVDP/サウンド周りの「ファーム機能」を活用して、当時のBASICでは難しかった音楽再生やスプライト動作を安定的かつ効率的に実装する手法を解説します。

## この記事を読むべき理由
レトロ開発やエミュレータ／FPGA実装、あるいは組み込み機で「限られたROM/VRAMをどうやりくりするか」を学びたい日本のエンジニア／愛好家にとって、TI固有のアドレス空間やファームウェアAPIの実務的ノウハウは即戦力になります。

## 詳細解説
- アドレス空間の基本
  - TIの工具表記では16進数を「>」で表記。カートリッジには通常ROM（CPU空間の>6000->7FFF、8KB）とGROM（仮想的に分離されたGROM空間、領域は>6000->F7FFなど）があり、個々のGROMは6KB実データを8KB分のアドレス枠に収める（実アドレス例：>6000->77FF, >8000->97FF…）。
  - GROMコード（旧称GPL）はGROM固有のバイトコードで、多くのVDP/IO機能と密に連携する。

- サウンド（SN76489）とサウンドリスト
  - サウンドリスト開始は、リストのワードアドレスを>83CCに置き、>83CEにバイト値>01を書き込むだけで割り込みルーチンが再生を始める（GROM配置ならフラグ設定不要なことが多い）。
  - サウンドリストのレコードは「書き込むバイト数」「そのデータ群」「次レコードまでのフレーム数（0で終端）」の繰り返し。実用上は短いSEやジングル向けで、長い曲はレコード膨張でGROM容量（6KB）を圧迫する。
  - 注意点：割り込み有効化、ネイティブ機械語ならLIMI 2（割り込み許可）を忘れないこと。システムフラグ>83FDのLSBでサウンドリストがVRAM（1）かGROM（0）かを指定。>83C2の特定ビット（>80・>20）が0である必要あり。メインROMからは実行不可。

- 実践的な教訓（元記事の観察）
  - SN76489の最低音は約110Hzで低音域が不足するため、楽曲の移調やアレンジが必要になる場合が多い。
  - 長尺の音楽はサウンドリスト方式に不向き。A/Bパートに分割してメインコードでループ管理する、あるいは自作の再生ルーチン（ノート表現を圧縮しエンベロープを管理する）を使うのが現実的。
  - サウンドリストはレジスタ書き込みのストリームなので、音楽と効果音を混在させる運用（干渉しない声だけを使う／割り込み配慮で共存）は可能。

- GROM側からの明示I/O
  - GROMバイトコードにはI/O命令があり、I/O x, addrでサウンドリスト再生を指示できる（x=0:GROM、1:VRAM、addrはスクラッチパッド内アドレス）。頻繁にGROM/VRAMを切り替えるケースで便利。

- スプライトと自動移動
  - スプライト属性テーブルはVDP上で>0300に配置（VDPレジスタ5が>06であること）。スプライト移動テーブルはVRAMの>0780->07FFに固定されるため、その領域を開ける必要あり。
  - 移動テーブルのレコードは「Y速度、X速度、スクラッチ2バイト」。速度は「16フレーム当たりのピクセル」または4.4固定小数点で表現される（ピクセル/フレーム = 4.4形式）。
  - VDP初期レジスタ（起動時のデフォルト）：Reg0 >00、Reg1 >E0、Reg2 >00、Reg3 >0E、Reg4 >01（パターンテーブル>0800）、Reg5 >06、Reg6 >00、Reg7 >17。スプライトパターンは128〜240あたりを使えば他領域と衝突しにくい。

## 実践ポイント
- まずは短いジングルや効果音でサウンドリストを試し、容量と再生制御（>83CC/ >83CE、割り込み）を確認する。
- 長い楽曲はA/Bに分割するか、自作のプレイヤーを作る（ノート圧縮とエンベロープ管理で容量削減）。
- GROMでルーチンを書くときはスクラッチパッド（256バイト）とVRAMへのコピー制約を意識する。ポインタ処理は制限が厳しいので、曲やテーブルはVRAMに置いてインデックスで回す設計が現実的。
- スプライトはVDPレジスタ5を>06に維持し、移動テーブルが使うVRAM領域（>0780->07FF）を確保しておく。
- 実機やエミュで試す際は割り込みフラグと>83C2のビット、LIMI 2の有無を必ず確認する。

短く言えば：TI-99/4Aは「ファームウェアを信頼して使えば」BASIC時代の限界を越えられる。サウンドは用途に応じてサウンドリストと自作プレイヤーを使い分け、スプライトはVDPの固定制約を計画的に扱うと良い結果が出ます。
