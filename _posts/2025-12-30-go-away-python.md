---
layout: post
title: "Go Away Python - Python、さようなら"
date: 2025-12-30T11:18:12.964Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://lorentz.app/blog-item.html?id=go-shebang"
source_title: "Go Away Python"
source_id: 46431028
excerpt: "shebangで壊れる小スクリプトを安全に配布・運用する具体的対処法を紹介"
---

# Go Away Python - Python、さようなら
Pythonのshebang問題を一撃で回避する — 小さなスクリプトを壊さない実践ガイド

## 要約
元記事はlorentz appのブログ実験として、Pythonに依存するスクリプトのshebang（#!）周りの面倒ごとをどう避けるかを短く扱っています。本記事では日本の開発現場で当面遭遇する典型的な問題と現実的な対処法をまとめます。

## この記事を読むべき理由
ローカル環境やCI、ユーザー環境で「#!/usr/bin/python」が期待通り動かない、Python2/3の違いで壊れる、あるいはシステムPythonを弄りたくないといったトラブルは日本の現場でも頻出です。手元の小さなユーティリティを安全に配布・運用したいエンジニアやSRE向けに、すぐ使える回避策を短く提示します。

## 詳細解説
- shebangの基本と落とし穴  
  shebangはスクリプト実行時に使うインタプリタを指示しますが、環境依存（例: /usr/bin/python が存在しない、あるいは Python 2 が指される）やパス長制限、Windowsとの非互換などで問題になります。macOSやLinuxディストリでのデフォルトPythonの有無、CIコンテナの軽量化による不在も原因です。

- よくある対策とその短所
  - /usr/bin/env を使う: 柔軟だがユーザーのPATH次第で意図しないインタプリタが選ばれることがある。  
  - virtualenv/venvやpyenv: 環境を分離できるがセットアップ手順が増える。CIやエンドユーザーに負担が生じる。  
  - パッケージ化（wheel / entry_points）: 正攻法だが小さなスクリプトや実験的コードにはオーバーヘッド。

- 実践的な代替アプローチ（元記事の実験的精神を受けて）
  - 簡易ラッパー（POSIX sh）でインタプリタ解決を明示する。これならどの環境でも期待通りの実行が可能。  
  - envの-Sオプションを活用して複数引数を渡す（環境によっては未サポート）。例:
```shell
#!/usr/bin/env -S python3 -u
```
  - 実行ファイル化: 小さなユーティリティならGoやRustで単一バイナリにする（配布が楽、依存ゼロ）。これは「Pythonを放棄する」選択肢として有効。  
  - コンテナ化: 実行環境を完全に固定したいなら軽量なコンテナで配布。CIとの親和性が高い。

## 実践ポイント
- まずは /usr/bin/env python3 を標準にする（互換性と将来性を考慮）。ただしPATHの管理に注意。  
- 配布対象がエンドユーザー（開発者以外）の場合は、バイナリ化（Go/Rust）かインストーラーを検討する。  
- CIやプロダクションではイメージに明示的なPythonを含め、バージョン固定で差異を潰す。  
- スクリプトに互換性チェックを入れる（起動時に必要なバージョンを検査して明確なエラーメッセージを出す）。  
- 短期的な実験や個人ツールはlorentz appのような「軽い実験」を経て、必要なら段階的にパッケージ化する。

