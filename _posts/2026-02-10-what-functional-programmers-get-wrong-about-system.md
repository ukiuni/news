---
layout: post
title: "What Functional Programmers Get Wrong About Systems - 関数型プログラマがシステムについて見落としていること"
date: 2026-02-10T06:45:06.591Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://iankduncan.com/engineering/2026-02-09-what-functional-programmers-get-wrong-about-systems/"
source_title: "What Functional Programmers Get Wrong About Systems - Ian Duncan"
source_id: 981770356
excerpt: "型に頼らず、旧版と混在するデプロイやスキーマ移行で事故を防ぐ設計を学べ"
image: "https://iankduncan.com/portrait.jpg"
---

# What Functional Programmers Get Wrong About Systems - 関数型プログラマがシステムについて見落としていること
魅力的タイトル: 型で安心しすぎると落とし穴にハマる――「プログラム」ではなく「デプロイの集合」を正しく考える技術

## 要約
関数型プログラミングで得られる強力な局所的保証（型、安全なデータ表現）は有益だが、実運用では「複数バージョンが同時に動く分散システム」を前提にした設計・運用が不可欠で、型チェックだけでは防げない不整合が頻発する、という指摘。

## この記事を読むべき理由
日本でもマイクロサービス、外部API連携、クラウド運用が当たり前になりつつあり、「単一のバイナリが全てではない」現実を理解しないと、リリースやスキーマ変更で重大な事故を招きやすいから。

## 詳細解説
- 「モノリス＝分散システムではない」という誤解：デプロイ形態（モノリスか否か）は別にして、複数サーバ、ジョブ、外部サービスとの連携があれば分散システム。問題の多くはコンポーネント間の相互作用にある。  
- 単一プログラムの正しさ（型チェック等）とシステム全体の正しさは別物：コンパイラは「一つのアーティファクト」を検証するが、本番では複数バージョン（旧版・新版・遅れたワーカー・古いメッセージ等）が同時に存在する。  
- 同時稼働バージョン問題：ローリングやカナリアで「異なるバージョンが並走」する期間が常にあり、例えば列挙型に新コンストラクタを追加すると旧プロセスは未知の値を受け取って死ぬ可能性がある。  
- BEAM/Erlangの教訓：言語／ランタイムレベルで「隣接2バージョンのみ」を保証し、実行時状態移行（state migration）を明示的に扱うことで実運用性を高めている。  
- スキーマとロールバックの非対称性（Migration Ratchet）：スキーマ変更は前方に不可逆な足跡を残す（DROP/ALTERは簡単に戻せない）。ロールバックは「古いコード＋新スキーマ」という未検証状態を生み危険。expand-and-contract（nullable追加→書き込み→バックフィル→切替→削除）のような段階的手順が必須。  
- メッセージ永続性の問題：Rabbit/Sidekiqは短期だが、Kafkaのように長期保持するキューは「過去の全バージョン」を解釈する必要があり、保持期間＝互換性ポリシーとなる。  
- 理論的制約：動的ソフトウェア更新の一般問題は不可決定（全て安全か判定できない）という結果があり、実務はドメイン特化のヒューリスティックと手順で対処する。

## 実践ポイント
- 正しさの単位を「デプロイの集合」にする：混在バージョンを想定したテストや演習を組み込む。  
- スキーマ変更はexpand-and-contractで段階的に実施し、ロールバックではなく修正で前進する運用を優先。  
- シリアライズは互換性重視（Protobuf 等）＋スキーマレジストリで書き込み時互換性を検査。  
- Kafka等長期保持を使うなら保持期間を互換性要件として決定し、古いイベントの扱い方を設計する。  
- 混在バージョン環境をCI/ステージでシミュレート（旧版メッセージを再生する等）して実稼働の齟齬を早期検出。  
- マイグレーションリント／gh-ostのようなツールを導入し、手順を自動化・可視化する。

（元記事：Ian Duncan, "What Functional Programmers Get Wrong About Systems", 2026-02-09）
