---
layout: post
title: "Improving 15 LLMs at Coding in One Afternoon. Only the Harness Changed - 編集ツールだけ変えたらLLMのコーディング精度が一晩で激変した話"
date: 2026-02-12T14:18:04.093Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "http://blog.can.ac/2026/02/12/the-harness-problem/"
source_title: "I Improved 15 LLMs at Coding in One Afternoon. Only the Harness Changed. | Can.ac"
source_id: 46988596
excerpt: "編集ハーネス変更だけで15LLMの修正成功率とコストが劇的改善"
image: "https://blog.can.ac/2026/02/12/the-harness-problem/og.png"
---

# Improving 15 LLMs at Coding in One Afternoon. Only the Harness Changed - 編集ツールだけ変えたらLLMのコーディング精度が一晩で激変した話
驚きの一手：モデルを替えずに「編集ハーネス」を変えただけでコーディング成功率が大幅改善

## 要約
モデルそのものではなく「ハーネス（編集インターフェース）」がボトルネックであり、行ごとに短いハッシュを付ける「hashline」方式などの編集フォーマット変更で、多くのモデルの実作業成功率とトークン効率が劇的に向上した。

## この記事を読むべき理由
日本の開発現場でも、LLMを組み込むと「理解はしてるのに編集が壊れる」「余計なリトライでAPIコストが跳ねる」といった問題に直面します。本記事は「モデルじゃなくツールの作り込み」で解決できる可能性を示し、低コストで信頼性を上げる実践的な示唆を与えます。

## 詳細解説
- 問題設定：多くの議論は「どのモデルが賢いか」に偏るが、実際の障害はモデルとコードベースをつなぐハーネス側で起きる。編集ツールのフォーマット次第で失敗率が大きく変わる。
- 既存アプローチ：
  - apply_patch（OpenAI系）：diff文字列を期待するが、フォーマットに依存して他モデルでは失敗しやすい。
  - str_replace（Claude系など）：古いテキストを正確一致で置換。空白やインデント差で頻繁に失敗。
  - 専用マージモデル（Cursor）：別モデルでパッチ適用を学習させるが、コストや汎用性の問題がある。
- 提案（hashline）：ファイルを読む際、各行に2–3文字のコンテンツハッシュを付与。モデルは「2:f1 を置換」「1:a3〜3:0e を差し替え」のようにハッシュで参照して編集を指示。ファイルが変わっていればハッシュ不一致で安全に拒否でき、モデルに古い行を完全再現させる必要が減る。
- ベンチマーク：Reactのランダムファイルに意図的なバグを入れて修正させる実験を多数回実行。結果は一貫して「patch形式が最悪」「hashlineやreplaceが優位」で、弱めのモデルほど改善幅が大きい（例：Grok Code Fast が 6.7% → 68.3% に飛躍）。トークン使用量や試行回数も削減。
- エコシステム的問題：ベンダーが外部ハーネスを締め出す動き（APIやアカウントの制限）があり、ハーネス改良の恩恵が特定ベンダー内に閉じる危険がある。オープンなハーネスなら複数モデルで最適化可能という論点。

## 実践ポイント
- まずは編集フォーマットを疑う：モデル変更前に、apply_patchや単純replaceでの失敗率を観察する。
- hashlineの導入を試す：行識別子で参照する設計は衝突検出と信頼性向上に有効。小規模プロトタイプで比較ベンチを回す。
- ベンチマークを自前で作る：実運用に近いファイル・バグで短いループを回し、成功率とトークン消費を測る。
- ベンダー依存を減らす：可能ならハーネスをオープンに保ち、複数モデルで最適化・テストする文化を作る。
- コスト監視：編集失敗のリトライでAPIコストが膨らむため、ハーネス改善は即座に経済効果につながる。

この記事は「モデル競争」のニュースを追うだけでなく、現場で信頼性を上げるための“地味だが高レバレッジ”な技術的投資を強く示唆します。
