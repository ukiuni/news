---
layout: post
title: "Show HN: Xcc700: Self-hosting mini C compiler for ESP32 (Xtensa) in 700 lines"
date: 2025-12-26T19:29:06.439Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://github.com/valdanylchuk/xcc700"
source_title: "Show HN: Xcc700: Self-hosting mini C compiler for ESP32 (Xtensa) in 700 lines"
source_id: 46392736
excerpt: "700行の自己ホスティングCコンパイラでESP32上で即時デバッグや現地パッチが可能"
---

# ESP32で「手のひらコンパイラ」を動かす — 700行の自己ホスティングCコンパイラ xcc700 の中身

## 要約
700行に凝縮された単一ファイルのCコンパイラがESP32（Xtensa）向けに自己ホスティング可能で公開されている。小さく理解しやすい実装は、ホットフィックスや組込みデバッグ、教育用途に強力に刺さる。

## この記事を読むべき理由
ESP32は日本のIoT／組込みプロジェクトで広く使われている。重厚なフルコンパイラに頼らず、動作を把握できる小型コンパイラで即時性のある開発フローや教育教材、ランタイム修正ができる点は現場での価値が高い。

## 詳細解説
- 概要  
  xcc700は単一のCソース（xcc700.c）で実装されたミニCコンパイラ。ターゲットはXtensa（ESP32）。出力はREL形式のELFで、そのままESP-IDFのelf_loaderで読み込める設計。

- 機能セット（最小限だが実用的）  
  while / if-then-else、int/char/ポインタ/配列の限定サポート、関数定義／呼び出し、算術・ビット演算、リテラルとパッチ処理。ELFライターとXtensa向けバイトコードエミッタを備える。

- 自己ホスティングと実行形態  
  3つの実行オプションがある：  
  A) ホスト上でgccでビルドしてクロスコンパイラとして実行（Mac x86_64/arm64で動作確認）  
  B) xtensa-gccや上で生成したバイナリをESP32用にビルドしてesp上で動作させる（実際に自身をコンパイルできる）  
  C) ソースを組み込んでファームウェア内の関数として呼ぶ — つまりデバイス上で動的コンパイル生成が可能

- 性能とサイズ感  
  リポジトリ例の出力ではテキストセクションが数十KB、ビルドはESP32上で高速（サンプルで17500行/sec相当）。ただし時刻分解能の違いでPOSIX上のタイミングは比較に注意。

- アーキテクチャ依存性  
  Xtensa固有のバイトコード生成を行うため、命令セット理解が必要。だがELF出力や基本的なパース/コード生成は流用しやすく、他アーキテクチャへの移植の教育的素材として有用。

## 実践ポイント
- まず手元で試す（最短）
```bash
# リポジトリをクローンして gcc でビルド
git clone https://github.com/valdanylchuk/xcc700
cd xcc700
gcc xcc700.c -o xcc700

# 自分自身をコンパイルしてELFを生成
./xcc700 xcc700.c -o xcc700.elf
```
- ESP32上で試す：生成したELFをESP-IDFのelf_loaderで読み込む。小さなホットフィックスやテスト用コードをデバイス上で素早く回せる。  
- 学習用途：コンパイラ入門（字句解析→構文解析→中間表現→コード生成→ELF作成）を1ファイルで追えるため、実装を読んでステップごとに改造して学ぶと効率的。  
- 現場での活用例：CIでの小さなテストビルド、現地デバイスに対する簡易パッチ配布、低リソース環境での動的コード生成。  
- 拡張案（着手しやすい）: 型の拡張、最適化パス追加、外部ライブラリ呼び出しのブリッジ、別アーキテクチャ（例：RISC-V）へのバックエンド移植。

