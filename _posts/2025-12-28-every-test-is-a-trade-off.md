---
layout: "post"
title: "Every Test Is a Trade-Off - すべてのテストはトレードオフである"
date: "2025-12-28 23:30:29.104000+00:00"
categories:
- tech
- world-news
tags:
- tech-news
- japan
source_url: "https://blog.todo.space/2025/12/27/buying-the-right-test-coverage/"
source_title: "Buying the Right Test Coverage (With a Deductible) — todo.space blog"
source_id: "437067562"
excerpt: "テストは保険料にすぎない―実運用でCI負荷と効果を測り取捨選択せよ"
---
# Every Test Is a Trade-Off - すべてのテストはトレードオフである

## 要約
テストはバグを「なくす」ものではなく、失敗を安くするための投資（保険料）にすぎない。だからこそ、どのシナリオをテストするかは技術判断だけでなく経済判断でもある——無制限に増やしていいわけではない。

## この記事を読むべき理由
日本のプロダクト開発でもCIコスト、フィードバック遅延、テストのフレークや依存性問題は日常茶飯事だ。テストを単なる「正義」として増やす前に、費用対効果で取捨選択する視点が必要になる。

## 詳細解説
- テストの本質: テストは欠陥の「不在」を証明できない（Dijkstraの指摘）。テスト自身もソフトウェアであり、バグやメンテナンスコストを生む。
- コスト要素: 書くだけでなく、実行インフラ（CI時間、クラウド費用）、メンテナンス（依存先の変化で割れる）、デバッグ/再実行の労力、フィードバックループの遅延が含まれる。
- トレードオフの枠組み: 問題の重大度・発生頻度・依存度・将来のもろさ（brittleness）を天秤にかけ、テストを書くことで得られる「失敗を事前に捕まえる価値」と継続コストを比較する。
- 典型的な失敗例: 著者の事例では、Nettyの内部APIに依存する重たい SOCKS テストが、ライブラリアップデートで壊れてCIを汚染。バグ自体は稀でテストのコストだけが増えた。
- 運用上の示唆: 新しいテストは恒久化せず「試験（probation）」に置き、実際の利用データ（ログやトレース）を見てホットパスに絞る。テストはP&Lの片隅に存在する投資であると明示的に扱うべき。

## 実践ポイント
- 新規テストは一定期間「試験運用」にする（例: 3か月）。その間に出現頻度や効果を計測して恒久化を判断する。  
- テスト追加がCIに与える「秒数」をPRで計測・記録し、累積影響を可視化する。  
- 本番ログ／トレースを集めて「実際に使われるパス」にテストを集中させる（ホットパス優先）。  
- 外部ライブラリの内部APIやprotected領域に依存するテストは避ける。代わりに再現用の小さなローカルリポジトリを保管しておく。  
- フレーク率、ビルド時間、テストごとのコストをKPI化して運用に組み込む。  
- 「ある欠陥を今すぐ直すコスト」と「それを防ぐテストの継続コスト」を比較し、場合によってはテストを省略して欠陥を受容する選択を正当化する。  
- 定期的に「死んだテスト」を掃除する（使用されないデータセットや古い依存に縛られたテストなど）。

