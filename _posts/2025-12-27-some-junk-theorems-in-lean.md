---
layout: post
title: "Some Junk Theorems in Lean"
date: 2025-12-27T12:39:23.472Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://github.com/James-Hanson/junk-theorems-in-lean"
source_title: "Some Junk Theorems in Lean"
source_id: 46364567
excerpt: "Lean/Mathlibで証明できる直感外の定理群の原因と対策を解説"
---

# Leanで証明された「ジャンク定理」集――型理論が生む直感と齟齬の正体

## 要約
Lean4 + Mathlibで形式化された「意味不明」に見える定理群を紹介し、なぜ生じるのかを技術的に解説する。形式化の落とし穴を知ることで、実務的な検証・設計判断に役立てられる。

## この記事を読むべき理由
Leanや定理証明器を仕事や研究で使う日本のエンジニア／研究者にとって、形式的に「証明できるが直感に反する」命題の存在は設計や信頼性評価に直接関わる。Mathlibのような大規模ライブラリを安全に使うための注意点が得られる。

## 詳細解説
James Hanson氏のリポジトリ "Some Junk Theorems in Lean" は、Lean4 + Mathlib 上で形式的に証明できる一群の「ジャンク定理」を集めたものです。例としてリポジトリで挙げられているものには次のようなものがあります（抜粋）：

- 有理数 $1/2$ の「第三座標」が全単射である。  
- 多項式 $X^2(X^3+X+1)$ の第一座標が $30$ の素因数分解に等しい。  
- 多変数多項式 $P=(X_0+X_1+X_2)^3$ と一変数 $Q=X^2+X+1$ を使い、$P$ の第二座標に $Q$ の第一座標を入れると自然数 $6$ になる。  
- 集合論的／位相的に「非直感的」な性質（例：リーマン予想がある位相的閉包に含まれる）を示す命題。

これらが「あり得る」理由は大きく分けて次の技術的要因です。

1. 表現と抽象化のギャップ  
   Leanでは有理数や多項式などが「structure（レコード）」や別の内部表現で実装される。構成要素（フィールド）の取り出し方や内部の余剰情報に依存すると、人間の数学的直感とは異なる等式や関係が生じ得ます。ライブラリの具体的実装に依存した命題は直感と齟齬を起こします。

2. 非構成的手法（classical, choice, noncomputable）  
   Mathlibには古典論理や選択公理、非計算的定義が頻用される箇所があるため、「存在」を主張しても構成的な内容（具体的な関数や値）が与えられないことがある。これが奇妙な恒等や写像の存在証明につながることがあります。

3. 型・コアーション・typeclass 解決の副作用  
   Leanの coercion や typeclass 解決は型の自動変換を行うため、表現の差が隠蔽されて意図しない等式や写像が導かれることがあります。特に多層の coercion が絡むと見た目では分からない変換が内部で働きます。

4. 証明オブジェクトと証明不可視性（proof irrelevance）  
   証明の等価性や証明の扱いに関する理論的な違い（例えば同値だが実際の証明オブジェクトが異なる）も、直感とのズレを生み出します。型理論での等式は構造的であり、数学者が想定する“意味”とは異なる場合があります。

5. 部分関数性・非終端・unsafeコード  
   「部分的関数」や非終端計算、あるいは unsafe 手段を使うと、言語の意味論を壊しかねない挙動が入り混じり、見かけ上の奇妙な定理につながる場合があります。

上記の要因が組み合わさって、元記事にあるような「数学者を驚かせる」定理群が生まれます。重要なのは「形式的に証明可能＝直感的に正しい」ではない点です。形式化では「実装や論理の選択」が結果に強く影響します。

## 実践ポイント
- 抽象インターフェイスを使う：データ型の内部実装（recordのフィールド等）に依存する証明は避け、抽象的な性質（群・環の公理）で書く。  
- classicalやchoiceを慎重に使う：非構成的手法は境界で限定的に採用し、計算可能性が必要な箇所では避ける。  
- 実装の読み込み：Mathlibの型定義やcoercionの実装を読む習慣をつけ、表現依存の脆弱性を把握する。  
- テスト／再現：リポジトリの例をローカルで実行して挙動を確認すると理解が深まる（Leanのバージョン差にも注意）。  
- レビュー文化：形式証明のPRでは「どの公理・どの表現に依存しているか」を明示するルールを設けると安全性が高まる。

Leanや形式化は強力だが、「何を証明できるか」は理論と実装の掛け合わせで決まる。ジャンク定理は警鐘でもあり、同時に型理論を学ぶ絶好の教材でもあります。

