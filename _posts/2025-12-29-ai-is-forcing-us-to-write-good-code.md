---
layout: "post"
title: "AI is forcing us to write good code - AIが私たちに良いコードを書くことを強いている"
date: "2025-12-29T23:29:01.900Z"
categories:
- tech
- world-news
tags:
- tech-news
- japan
source_url: "https://bits.logic.inc/p/ai-is-forcing-us-to-write-good-code"
source_title: "AI Is Forcing Us To Write Good Code - by Steve Krenzel"
source_id: "46424200"
excerpt: "AIと安全に共働するために100%テストと型・高速環境を必須化する実践ガイド"
---

# AI is forcing us to write good code - AIが私たちに良いコードを書くことを強いている

## 要約
AIエージェントを実戦投入するなら、これまで「オプション」だったベストプラクティスが必須になる。100%テストカバレッジ、細かいファイル分割、超高速・エフェメラルな開発環境、厳格な型・自動整形――これらがエージェントと協働するための最短ルートだ。

## この記事を読むべき理由
日本のプロジェクトではレガシーや属人化が障害になりやすい。AIを使った自動コーディングは生産性を劇的に上げる反面、ガードレールが甘いと欠陥を拡大する。今から環境とプロセスを整えれば、AIの利点を安全に享受できる。

## 詳細解説
- 100%テストカバレッジを要求する意義  
  単にバグゼロを約束するためではなく、エージェントが書いた全行動に対して「実行可能な挙動の証拠」を強制するため。未カバーの行があればカバレッジレポートがそのままTodoになり、エージェントはその行を「実行例で説明」する必要がある。結果として死にコードの削除やエッジケースの明示化が進む。

- ファイル構造と名前空間（＝ファイル名・ディレクトリ設計）の重要性  
  多くのエージェントはファイルシステムをインタフェースとして使うため、./billing/invoices/compute.ts のように意味が伝わる構成が効く。大きなファイルより小さく責務を限定したファイル群の方が、エージェントが文脈を完全に読み込めるため誤解や要約による情報欠落を減らす。

- 高速・エフェメラル・並列な開発環境  
  エージェントは何度もテストや修正を繰り返す。毎回数十分かかると実用性が落ちるため、テスト・DBセットアップ・外部APIキャッシュを高速化し、ワンコマンドで新しい作業ツリー（worktree）を作れる仕組みを用意する。複数環境を同時に動かせるように環境変数やポート、DB名の衝突回避も必須。

- 型と自動化でLLMの選択肢を絞る  
  厳密な型システム（例：TypeScript）や自動整形・リンターを導入し、エージェントが取れる行動の「自由度」を減らす。型名に意味を持たせる（UserId、SignedWebhookPayload等）ことで、モデルが意図を即座に理解しやすくなる。APIはOpenAPIでスキーマを定義しクライアントを生成、DB側も型やチェック、トリガで防御する。

- キャッシュとCI運用のバランス  
  開発時は高速化のためにキャッシュを活用しつつ、マージ前やCIではキャッシュ無しでテストを回して外部依存やキャッシュ前提の不整合を検出する。

## 実践ポイント
- まずは「100%カバレッジの制度化」  
  CIで未カバー行があるPRをブロックする。カバレッジレポートをTODOリストとして運用する。

- ディレクトリ命名規約を作る  
  例：/billing/invoices/compute.ts のようにドメイン志向で細かく分ける。大きなファイルは分割するルールを導入。

- 超高速テスト基盤を作る  
  - 高並列テスト、DBを作り捨てできる仕組み、外部APIのローカルキャッシュ／スタブを用意する。  
  - 開発中はキャッシュ有り、CIはキャッシュ無しで最終チェック。

- エフェメラルなワークフローを用意（例）  
  bash
  ```bash
  # 新機能用ワークツリーを作る（例）
  git worktree add ../feature-<name> HEAD
  cp .env.local ../feature-<name>/.env
  (cd ../feature-<name> && npm ci && npm run dev)
  ```
  一コマンドで環境を作り、エージェントを即起動できるようにする。

- 自動整形・リンターの強制化  
  pre-commit や githook で自動修正→コミット、エージェントのコミット前に自動整形を走らせる。

- 型を作り込む／API型を自動生成する  
  OpenAPIからクライアント生成、DBスキーマと型を整合させる。型名に意味を持たせる運用ルールを導入。

- DB側の不変条件を増やす  
  Postgresのチェック制約やトリガ、型を活用してエージェントの誤書き込みを早期に検出する。型安全なクエリビルダを使うとさらに効果的。

短期的には手間に見えるが、これらを投資として計上しイテレーションのコストを下げれば、AIエージェントは「大量のバグを生むRoomba」ではなく「疲れ知らずの優秀なコーダー」になる。日本の現場でも、まずはテスト・型・環境自動化から着手するのが現実的な一歩だ。
