---
layout: post
title: "I reversed Tower of Fantasy's anti-cheat driver: a BYOVD toolkit never loaded - Tower of Flaws：Tower of Fantasyのアンチチートドライバを解析したら“高権限の欠陥”が山ほど見つかった"
date: 2026-02-06T03:42:28.971Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://vespalec.com/blog/tower-of-flaws/"
source_title: "Tower of Flaws: Dismantling Tower of Fantasy&#39;s Anti-Cheat Driver While Waiting for The Game to Install | Vespalec"
source_id: 46908671
excerpt: "Tower of Fantasyのドライバに高権限欠陥多数、端末が丸ごと危険に"
image: "https://vespalec.com/_astro/cover.i5o86z-8.jpg"
---

# I reversed Tower of Fantasy's anti-cheat driver: a BYOVD toolkit never loaded - Tower of Flaws：Tower of Fantasyのアンチチートドライバを解析したら“高権限の欠陥”が山ほど見つかった
ゲームをインストールしている間に見つけた、カーネルレベルのアンチチートドライバが抱える設計上の脆弱性とその影響を分かりやすく解説します。

## 要約
海外研究者がTower of Fantasy付属のカーネルドライバを逆解析したところ、認証が形骸化しており「高権限で何でもできる」インターフェースが露出していた。設計ミスや単純な実装欠陥が多数あり、悪用されればシステム全体の安全性に深刻な影響を与え得る。

## この記事を読むべき理由
日本のPCゲーマー／開発者にとって、ゲームに同梱されるカーネルドライバは利便性と引き換えに高いリスクを伴います。特に企業の開発機や個人の重要データが載った端末で未知のドライバを動かすリスクを理解しておくことは必須です。

## 詳細解説
- 背景（HVCIと難読化の関係）  
  WindowsのHVCI（Hypervisor-Protected Code Integrity）とW^Xポリシーにより、一般的なパッカー／難読化ツールは動作しにくい。結果としてドライバが平文に近い状態で配送され、解析が容易になるケースがある。

- ドライバの役割とインターフェース  
  対象ドライバはカーネル側で「保護プロセス」の管理やハンドル権限の書き換え、プロセス強制終了、カーネルメモリ参照など強力な操作を受け付けるIOCTLインターフェースを持つ。これらは本来厳重に制限・認証されるべき操作です。

- 認証とバイパスの問題点（要点のみ）  
  1) DLL存在チェック：PEB上のモジュール名だけを見て判定しており、名前を書き換えただけで通ってしまう。  
  2) ホワイトリスト：名前比較の実装ミスで「前方一致」的に判定される箇所があり、想定外のプロセスが通る可能性がある。  
  3) チェックサム検証：PEチェックサムに頼る実装は改変防止として脆弱。  
  4) 固有の認証値：バイナリ中の定数に依存するだけで、静的解析すれば簡単に特権機能を呼び出せる。  
  これらが積み重なり“認証はあるが事実上無い”状態になっている。

- カーネルAPIの使い分けによる影響  
  カーネルから非公開／低レベルのAPI（研究記事で言及されるような呼び出し形態）を使うと、通常のオブジェクトセキュリティチェックを回避できる場合があり、特権操作がより危険になる。

- 防御的な設計欠陥  
  難読化の欠如、脆弱なホワイトリスト実装、簡単に推測可能な認証、厳密でないハンドル権限制御などが同居しているため、バグや悪用のリスクが増幅している。

## 実践ポイント
- 一般ユーザー向け  
  - 不要なゲームやそのランチャーに同梱されるカーネルドライバは入れない／仮想環境で動かす。  
  - 信頼できるセキュリティ製品を利用し、システムの整合性保護（例：HVCIなど）を有効化する。  
  - インストール前に配布元とドライバの署名・説明を確認する。重要端末では特に注意を。  

- 開発者／運用者向け  
  - カーネルドライバは最小限の機能に絞り、ユーザ空間で実現できる機能はそちらで実装する。  
  - IOCTLや認証は暗号的なチャレンジ/レスポンスやデジタル署名で保護し、単純な定数や名前照合に頼らない。  
  - ホワイトリストや名前比較は確実な長さチェックと完全一致で実装し、PE検証にはより堅牢な手法を使う。  
  - コードインテグリティ（署名／HVCI対応）や第三者監査を導入する。

短くまとめると、今回のケースは「高権限を持つコードが不適切に実装されると、その高権限が即ち攻撃面になる」ことを示す典型例です。ゲーム側とプラットフォーム側の両方で設計・運用の見直しが求められます。
