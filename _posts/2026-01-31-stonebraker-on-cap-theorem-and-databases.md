---
layout: post
title: "Stonebraker on CAP theorem and Databases - StonebrakerによるCAP定理とデータベース論"
date: 2026-01-31T02:36:52.524Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://perspectives.mvdirona.com/2010/04/stonebraker-on-cap-theorem-and-databases/"
source_title: "Stonebraker on CAP Theorem and Databases &#8211; Perspectives"
source_id: 46831592
excerpt: "CAP神話を覆す、最終整合性では防げない実務リスクと強整合の現実的対策とは？"
---

# Stonebraker on CAP theorem and Databases - StonebrakerによるCAP定理とデータベース論
クリックしたくなる日本語タイトル: CAP神話を見抜く — 「整合性か可用性か」だけでは語れない真実

## 要約
NoSQL界隈でよく言われる「CAP定理＝整合性を諦めて最終整合性を取るしかない」は必ずしも正しくない、というMike Stonebrakerらの主張。多くの運用・アプリケーション障害は最終整合性で解決できないことを指摘している。

## この記事を読むべき理由
CAPや最終整合性は技術トレードオフの王道話題ですが、誤解や乱用が多く、日本のスタートアップ〜既存事業のエンジニアにとって設計ミスや運用リスクにつながりやすい。適切な選択基準と実務での対策が分かります。

## 詳細解説
- CAP定理の要点：分散システムはConsistency（整合性）, Availability（可用性）, Partition tolerance（分断耐性）の三つのうち全てを同時には満たせないという理論的制約。  
- NoSQL側の解釈：分断が前提なら整合性を緩めて可用性を優先し、最終整合性（eventual consistency）を採る例が多い。  
- Stonebrakerの指摘：  
  - アプリケーションバグ、誤操作、DB実装バグによる「データ消失」は、最終整合性で防げない。消えたデータはオフラインのコピーがなければ戻らない。  
  - ネットワーク分断は理論上は重要だが、実務では稀とはいえない。設定ミスや機器障害で断片的な障害は起きる。  
  - したがって「CAPだから最終整合性しか選べない」と決めつけるのは誤り。フル整合性（強整合）を実装可能か検討すべき場面が多い。  
- 運用的対策の例：Deferred delete（削除は即ゴミ箱化して一定期間経ってから完全削除）、定期バックアップ／オフラインコピー、障害注入やパーティションテストで実挙動を把握。  
- 実装の変化：記事当時からも、クラウド系ストアは強整合モードやオプションを提供する方向に進んでおり、整合性選択は柔軟になってきている。

## 実践ポイント
- 初期デフォルトは「強整合を基本」に検討する（アプリの単純さ・バグ低減に寄与）。必要なら逐次緩和。  
- 削除は即破棄せずDeferred deleteを採用し、誤削除対策を行う。  
- 定期的なオフラインバックアップとリカバリ手順を整備する（法規制対応も考慮）。  
- ネットワーク障害や分断を想定した障害注入テストを実施し、挙動とSLOへの影響を評価する。  
- クラウド提供の整合性オプション（強整合／最終整合）を理解して使い分ける。  

短くまとめると、CAPは設計判断の道具だが「理由なき妥協」は避けるべき。整合性の選択はアプリ要件・運用能力・リスク許容度で決め、バックアップや運用プロセスでカバーすることが肝要です。
