---
layout: post
title: "Reverse Engineering Sid Meier's Railroad Tycoon for DOS from 1990 - 1990年版『シド・マイヤーのレールロード・タイクーン』をDOS向けにリバースエンジニアリング"
date: 2026-02-18T05:59:29.002Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://www.vogons.org/viewtopic.php?t=105451"
source_title: "Reverse Engineering Sid Meier's Railroad Tycoon \ 									VOGONS"
source_id: 47015138
excerpt: "1990年版『Railroad Tycoon』を逆解析し資産抽出から移植技術まで解説"
---

# Reverse Engineering Sid Meier's Railroad Tycoon for DOS from 1990 - 1990年版『シド・マイヤーのレールロード・タイクーン』をDOS向けにリバースエンジニアリング
魅力的タイトル: 30年越しの“鉄道再生” — レトロ名作を現代解像度で蘇らせるリバース工房の舞台裏

## 要約
作者は1990年の名作『Railroad Tycoon』を3か月かけてDOS環境でデバッグし、画像・アニメ・マップ・列車描画など主要要素を抽出・解析して現代向けに移植する途中経過を報告している。

## この記事を読むべき理由
レトロゲームの資産解析・移植は単なるノスタルジーではなく、フォーマット解析・低レイヤデバッグ・GPU最適化など現代のエンジニアリングスキルが学べる実践教材です。日本のゲーム開発者や趣味でレトロタイトルをいじるエンジニアにとって即戦力となる知見が詰まっています。

## 詳細解説
- 解析対象と動機  
  金額上限や解像度などオリジナルの制約を解消したくて解析開始。子ども向けに遊びやすくしたいという実用的動機も。

- 環境とツール  
  DOSBoxをソースからビルドして直接ブレークポイントを仕掛ける手法が中心。IDA Proは必須ではなく、CPU命令やINT 21hなどのドキュメント参照（Intelマニュアル、古典的なINTリファレンス）が役立ったと報告。

- アセット解析（PIC / PAN / フォント / マップ）  
  - PIC画像フォーマット抽出は比較的短時間で完了。  
  - PAN（アニメ）解析は難易度高めで数週間。  
  - フォントはバイナリ閲覧で簡単に理解可能。  
  - マップは実はPICで、15色パレットを使うが、産業・生産者情報は別テーブル（実行ファイル内のルックアップ）で決定される。マップ生成に「シード値（uint16_t）」や座標、色が使われ、SVE（セーブ）ファイル内の位置に重要値がある。

- 実行時メモリ配置とオーバーレイの罠  
  ゲームは静的配置中心で malloc 呼び出しはごく僅少。ただしオーバーレイ（コードの差し替え）を多用するため、デバッグ時に呼び出し先が動的に変わり「Overlay not found」エラーや誤った関数追跡を招く。解析では毎回呼び出し先を確認する忌避すべきパターンが存在。

- 描画／最適化の発見と移植方針  
  - 軌道やインフラはオリジナルで「透明が多い画像を変換して描画回数を減らす」プリプロセスをしていたが、現代GPUでは非効率。著者はプリプロセスを省き、テクスチャ化とシェーダで代替。  
  - 「青系」資産（海や河口パーツ）は画面上の色を差し替える方式で描かれていたため、移植では事前に青バージョンを生成してテクスチャに格納する手法を採用。セル（16×16）とアセット（20×20）の扱いに注意が必要。  
  - 信号ライトはオリジナルではVRAM直書きが前提。移植ではglReadPixels等を避け、ピクセルシェーダーで「ソース色を置換する（マスクして描画）」実装に切り替えた。

- 列車データとサイドバー描画（興味深い逆解析例）  
  - SVE内の列車テーブル長は0x1580、1編成は0xAC（172）バイト、最大32編成で整合する。先頭2バイトがフラグ、オフセット2にエンジンインデックス、オフセット4に速度など。速度は2バイトで「表示バー長 = 速度 × 2」。  
  - サイドバー描画はエンジン描画関数を先に呼び、その後連結車両情報（各8バイト／車）を順次描く。オリジナルではエンジンを複数回重ね描きしていた痕跡があるが、移植では1回描画で問題なかった。  
  - フラグのビットテストで「信号待ち（トラック色が赤）」や「ボーナス貨物（エンジンを緑で描く）」などの状態を判別する。

- MVP（最小移植要件）  
  サウンド以外の機能互換、解像度非依存レンダリング、金額上限修正、セーブ数拡張、シングルプレイが動作することを目標にしている。

## 実践ポイント
- 開始手順（すぐできること）  
  1) DOSBoxをソースからビルドしてブレークポイントを仕掛ける（例：dos_files.cpp の DOS_OpenFile）。  
  2) SVEファイルをバイナリで開いて、列車テーブル（オフセット0x50、長さ0x1580）を確認。  
  3) PIC／PAN／フォントのバイナリを抽出して各フォーマットを解析する。  
- デバッグ上の注意  
  - オーバーレイによる関数差し替えに注意し、同一アドレス呼び出しごとに内容を再確認する。  
  - VRAM直アクセスをそのまま移すと非効率・移植困難になるため、テクスチャキャッシュ化やシェーダで置換する方針を推奨。  
- 参考資料と学習リソース  
  - INT 21h リファレンス（DOS API）とIntel CPUマニュアルは必読。  
  - セーブ→再生成で「決定論的」挙動を得られるので、複数セーブを比較してルックアップ動作を逆解析するテクニックが有効。  

興味が湧いたら、まずDOSBoxからビルドしてブレークポイントを仕掛け、SVEの列車セクションを覗くところから始めてください。成功例の多くは「ゲームを動かしながら少しずつ解析」する地道な積み重ねから生まれています。
