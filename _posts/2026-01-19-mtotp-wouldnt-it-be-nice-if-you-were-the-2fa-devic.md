---
layout: post
title: "MTOTP: Wouldn't it be nice if you were the 2FA device? - mTOTP：自分が2FAデバイスになれたらいいのに？"
date: 2026-01-19T08:43:15.058Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://github.com/VBranimir/mTOTP/tree/develop"
source_title: "GitHub - VBranimir/mTOTP at develop"
source_id: 46676264
excerpt: "スマホ不要で紙と暗算だけで生成する人力2段階認証の実験手法を解説"
image: "https://opengraph.githubassets.com/4e0a7d09e6331dd754651727a60381bbf74ce51697ba4f5cf0fef7c437f998cb/VBranimir/mTOTP"
---

# MTOTP: Wouldn't it be nice if you were the 2FA device? - mTOTP：自分が2FAデバイスになれたらいいのに？
スマホもトークンも不要──紙と頭だけで生成する“人力2段階認証”を試してみる

## 要約
mTOTPは、計算機やスマホを使わず人間の手で実行できるように設計された試験的なTOTP変種です。暗号的に標準TOTPと同等とは主張しませんが、意図的な時間指定と可検査性を重視した仕組みを示します。

## この記事を読むべき理由
- 災害時や電子デバイスが使えない状況での認証手法としての発想が面白い。  
- セキュリティの“代替案”や可視化・教育用ツールとして、日本の小規模運用や監査、啓蒙に応用できる可能性があるから。

## 詳細解説
mTOTPは「秘密の数字キー」と「予定ログイン時刻」から人間が計算できる6桁ワンタイムパスワードを生成します。主な特徴とアルゴリズムは次の通りです。

1. 前提と狙い  
   - 人間が暗算や紙で再現できることを最優先に設計。  
   - 時刻は「予定した時刻」を明示的に使う（未来の時刻も計算可能）。  
   - 暗号的強度は標準TOTPと同等ではないと明示。

2. 入力フォーマット  
   - 秘密キー：10桁の数字（短ければ決められた方法でパディング）。  
   - 時刻：YYMMDDHHMM で表す（例：2026-01-17 17:00 → T = 2601171700）。

3. S-box（置換表）の作成  
   - 秘密キーを左から見て、初出の桁を順に書き出す。重複は無視。  
   - 残る数字（0–9のうち未出現）を順に末尾へ追加。  
   - 位置が入力桁、値が出力桁の置換表になる（例：鍵 1234598760 → S-box = 1,2,3,4,5,9,8,7,6,0）。

4. 時刻と鍵の位置ごとの合算（mod 10）  
   - 各桁について $c_i = (t_i + k_i) \bmod 10$ を計算して 10 桁の中間列 C を得る。

5. S-box 置換  
   - C の各桁を S-box で置き換える（非線形性の導入）。

6. 拡散（Digit Mixing）  
   - 最初に変数 $a$ を最後の桁で初期化し、左から順に $new = (digit + a) \bmod 10$、$a \leftarrow new$ を繰り返す。これにより一箇所の変更が以降に波及する。

7. 折り畳み（Fold to 5 Digits）と最終桁  
   - 左右を折って対応する桁を足し合わせ、5桁にする：$(c_1+c_6),(c_2+c_7),\dots$（いずれも mod 10）。  
   - 5 桁の和をとって $o_6 = (\sum_{i=1}^5 o_i) \bmod 10$ が最終の6桁目。

短い例（原リポジトリの例を要約）：
- Key = 1234598760, Time = 2601171700  
- 合算 → C = 3835669460  
- S-box 置換 → 4649880581  
- 拡散 → 5154200534  
- 折り畳み → OTP5 = 51076  
- 最終桁 $o_6 = (5+1+0+7+6)\bmod 10 = 9$ → 最終 OTP = 510769

注意点：アルゴリズムは可検査性と人間の実行性を優先しているため、遠隔での安全性やリプレイ耐性は標準TOTPとは異なります。

## 実践ポイント
- 試す前に必ず「非機密」環境で挙動を確認する。高価値の認証には使わないこと。  
- 秘密キーは常に10桁に統一して扱う（不足桁の補完方法を運用で決める）。  
- 時刻は「予定時刻」を合意しておくことが必須。サーバー側も同じ時刻を基に検証する運用ルールが必要。  
- 手で計算するには練習が必要。まずは紙でステップごとに検証ツール（リポジトリにはテストツールやPAMプラグインの実装例あり）と合わせて実行する。  
- 日本の現場での適用例：災害対応訓練、オフライン会議での臨時認証、教育・デモ用途、監査での可視化ツール。  
- セキュリティ上の注意：作者自身が「暗号学的同等性は主張しない」と明記しているため、本番の高リスク認証には標準的な2FA（ハード/ソフトトークン、WebAuthn等）を優先すること。

参考：実装やプラグイン（PAM、Keycloak予定）は元リポジトリにあり、手計算手順とツール両方が用意されています。興味があればリポジトリをクローンして動作を確かめ、手計算と照合してみてください。
