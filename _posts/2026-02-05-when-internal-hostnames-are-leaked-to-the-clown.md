---
layout: post
title: "When internal hostnames are leaked to the clown - 内部ホスト名が「クラウン」に漏れた話"
date: 2026-02-05T06:22:46.864Z
categories: [tech, world-news]
tags: [tech-news, japan]
source_url: "https://rachelbythebay.com/w/2026/02/03/badnas/"
source_title: "When internal hostnames are leaked to the clown"
source_id: 46895972
excerpt: "NASの内部ホスト名が外部に漏れ実害発生、設定ミスと対策を実例で解説"
---

# When internal hostnames are leaked to the clown - 内部ホスト名が「クラウン」に漏れた話
NASのローカル名が外部クラウドにばれてしまうと何が起きるか — 実例で学ぶ小さな設定ミスの大きなリスク

## 要約
ローカルで使っていたホスト名をワイルドカードTLS証明書と/etc/hostsで運用していたら、その名前が外部に漏れ、クラウドホストから接続試行が来るようになった。原因はデバイスやブラウザの「電話（telemetry）」で内部名が送信されたためと考えられる。

## この記事を読むべき理由
家庭用／小規模オフィスのNASやIoTを使う日本の開発者・管理者にとって、簡単な運用ミスで内部情報が外部に露出する現実と、その防止策を学べるから。

## 詳細解説
- 事象の流れ
  - NASにワイルドカードTLS証明書（例: *.nothing-special.whatever.example.com）を載せ、ローカルの/etc/hostsで内向きに名前解決して運用。
  - ブラウザ経由でNASの管理画面を開くと、デバイスやブラウザがクラッシュログやスタックトレースを外部のエラートラッキング（例: sentry.io）に送信。
  - 送信内容に内部ホスト名が含まれていたため、外部（GCPなど）の攻撃者やスキャナーがそのホスト名を使って接続を試み、SNIにその内部名を提示して接続してきた。
- なぜ漏れるか
  - テレメトリやエラーレポートに内部ホスト名が含まれていると、それが外部サービス経由で広まる可能性がある。
  - ワイルドカード証明書や公開可能なドメインを内部名に使うと、外部のDNS/スキャンと結びつきやすい。
- 観測された挙動
  - 外部からのTLS接続が来るがリクエストは送られない（SNIだけ確認して接続の可否を探るスキャン挙動）。

## 実践ポイント
- 内部専用ホスト名に公開ドメイン／ワイルドカード証明書を使わない。可能なら社内専用ゾーンかsplit-horizon DNSを使う。
- デバイスのテレメトリ／クラッシュレポートを確認・無効化する（設定でオフにできるか確認）。
- アウトバウンドの通信を制御する（ホスト側ファイアウォール／ルーターでsentry.io等の送信先をブロック）。
- SNI/アウトバウンド接続のログを監視し、見慣れないホスト名の外向き送信がないかチェックする。
- 漏れを検知するために、意図的にワイルドカードDNSを自分で向けて監視する（著者がやったように「ハニーポットDNS」で検知する手法）。
- 敏感な命名は避け、内部情報が推測される名前（例: merger-plan等）を付けない。

短い対策で被害を防げるケースが多いので、NASやIoTの初期設定を見直しておくことを推奨します。
